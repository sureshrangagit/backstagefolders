{"version":3,"file":"createFrontendFeatureLoader.esm.js","sources":["../../src/wiring/createFrontendFeatureLoader.ts"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ConfigApi } from '../apis/definitions';\nimport { describeParentCallSite } from '../routing/describeParentCallSite';\nimport { FrontendFeature } from './types';\n\n/** @public */\nexport interface CreateFrontendFeatureLoaderOptions {\n  loader(deps: {\n    config: ConfigApi;\n  }):\n    | Iterable<\n        | FrontendFeature\n        | FrontendFeatureLoader\n        | Promise<{ default: FrontendFeature | FrontendFeatureLoader }>\n      >\n    | Promise<\n        Iterable<\n          | FrontendFeature\n          | FrontendFeatureLoader\n          | Promise<{ default: FrontendFeature | FrontendFeatureLoader }>\n        >\n      >\n    | AsyncIterable<\n        | FrontendFeature\n        | FrontendFeatureLoader\n        | { default: FrontendFeature | FrontendFeatureLoader }\n      >;\n}\n\n/** @public */\nexport interface FrontendFeatureLoader {\n  readonly $$type: '@backstage/FrontendFeatureLoader';\n}\n\n/** @internal */\nexport interface InternalFrontendFeatureLoader extends FrontendFeatureLoader {\n  readonly version: 'v1';\n  readonly description: string;\n  readonly loader: (deps: {\n    config: ConfigApi;\n  }) => Promise<(FrontendFeature | FrontendFeatureLoader)[]>;\n}\n\n/** @public */\nexport function createFrontendFeatureLoader(\n  options: CreateFrontendFeatureLoaderOptions,\n): FrontendFeatureLoader {\n  const description = `created at '${describeParentCallSite()}'`;\n  return {\n    $$type: '@backstage/FrontendFeatureLoader',\n    version: 'v1',\n    description,\n    toString() {\n      return `FeatureLoader{description=${description}}`;\n    },\n    async loader(deps: {\n      config: ConfigApi;\n    }): Promise<(FrontendFeature | FrontendFeatureLoader)[]> {\n      const it = await options.loader(deps);\n      const result = new Array<FrontendFeature | FrontendFeatureLoader>();\n      for await (const item of it) {\n        if (isFeatureOrLoader(item)) {\n          result.push(item);\n        } else if ('default' in item) {\n          result.push(item.default);\n        } else {\n          throw new Error(`Invalid item \"${item}\"`);\n        }\n      }\n      return result;\n    },\n  } as InternalFrontendFeatureLoader;\n}\n\n/** @internal */\nexport function isInternalFrontendFeatureLoader(opaque: {\n  $$type: string;\n}): opaque is InternalFrontendFeatureLoader {\n  if (opaque.$$type === '@backstage/FrontendFeatureLoader') {\n    // Make sure we throw if invalid\n    toInternalFrontendFeatureLoader(opaque as FrontendFeatureLoader);\n    return true;\n  }\n  return false;\n}\n\n/** @internal */\nexport function toInternalFrontendFeatureLoader(\n  plugin: FrontendFeatureLoader,\n): InternalFrontendFeatureLoader {\n  const internal = plugin as InternalFrontendFeatureLoader;\n  if (internal.$$type !== '@backstage/FrontendFeatureLoader') {\n    throw new Error(`Invalid plugin instance, bad type '${internal.$$type}'`);\n  }\n  if (internal.version !== 'v1') {\n    throw new Error(\n      `Invalid plugin instance, bad version '${internal.version}'`,\n    );\n  }\n  return internal;\n}\n\nfunction isFeatureOrLoader(\n  obj: unknown,\n): obj is FrontendFeature | FrontendFeatureLoader {\n  if (obj !== null && typeof obj === 'object' && '$$type' in obj) {\n    return (\n      obj.$$type === '@backstage/FrontendPlugin' ||\n      obj.$$type === '@backstage/FrontendModule' ||\n      obj.$$type === '@backstage/FrontendFeatureLoader'\n    );\n  }\n  return false;\n}\n"],"names":[],"mappings":";;AA2DO,SAAS,4BACd,OACuB,EAAA;AACvB,EAAM,MAAA,WAAA,GAAc,CAAe,YAAA,EAAA,sBAAA,EAAwB,CAAA,CAAA,CAAA;AAC3D,EAAO,OAAA;AAAA,IACL,MAAQ,EAAA,kCAAA;AAAA,IACR,OAAS,EAAA,IAAA;AAAA,IACT,WAAA;AAAA,IACA,QAAW,GAAA;AACT,MAAA,OAAO,6BAA6B,WAAW,CAAA,CAAA,CAAA;AAAA,KACjD;AAAA,IACA,MAAM,OAAO,IAE4C,EAAA;AACvD,MAAA,MAAM,EAAK,GAAA,MAAM,OAAQ,CAAA,MAAA,CAAO,IAAI,CAAA;AACpC,MAAM,MAAA,MAAA,GAAS,IAAI,KAA+C,EAAA;AAClE,MAAA,WAAA,MAAiB,QAAQ,EAAI,EAAA;AAC3B,QAAI,IAAA,iBAAA,CAAkB,IAAI,CAAG,EAAA;AAC3B,UAAA,MAAA,CAAO,KAAK,IAAI,CAAA;AAAA,SAClB,MAAA,IAAW,aAAa,IAAM,EAAA;AAC5B,UAAO,MAAA,CAAA,IAAA,CAAK,KAAK,OAAO,CAAA;AAAA,SACnB,MAAA;AACL,UAAA,MAAM,IAAI,KAAA,CAAM,CAAiB,cAAA,EAAA,IAAI,CAAG,CAAA,CAAA,CAAA;AAAA;AAC1C;AAEF,MAAO,OAAA,MAAA;AAAA;AACT,GACF;AACF;AA8BA,SAAS,kBACP,GACgD,EAAA;AAChD,EAAA,IAAI,QAAQ,IAAQ,IAAA,OAAO,GAAQ,KAAA,QAAA,IAAY,YAAY,GAAK,EAAA;AAC9D,IAAA,OACE,IAAI,MAAW,KAAA,2BAAA,IACf,IAAI,MAAW,KAAA,2BAAA,IACf,IAAI,MAAW,KAAA,kCAAA;AAAA;AAGnB,EAAO,OAAA,KAAA;AACT;;;;"}