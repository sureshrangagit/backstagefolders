{"version":3,"file":"FixDialog.esm.js","sources":["../../../../src/components/Pods/FixDialog/FixDialog.tsx"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { FC, useState } from 'react';\n\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport IconButton from '@material-ui/core/IconButton';\nimport { makeStyles, createStyles, Theme } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport CloseIcon from '@material-ui/icons/Close';\nimport HelpIcon from '@material-ui/icons/Help';\nimport OpenInNewIcon from '@material-ui/icons/OpenInNew';\n\nimport { Pod } from 'kubernetes-models/v1/Pod';\nimport { DetectedError } from '@backstage/plugin-kubernetes-common';\nimport { PodLogs } from '../PodLogs';\nimport { Events } from '../Events';\nimport { LinkButton } from '@backstage/core-components';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    closeButton: {\n      position: 'absolute',\n      right: theme.spacing(1),\n      top: theme.spacing(1),\n      color: theme.palette.grey[500],\n    },\n  }),\n);\n\n/**\n * Props for FixDialog\n *\n * @public\n */\nexport interface FixDialogProps {\n  open?: boolean;\n  clusterName: string;\n  pod: Pod;\n  error: DetectedError;\n}\n\n/**\n * A dialog for fixing detected Kubernetes errors\n *\n * @public\n */\nexport const FixDialog: FC<FixDialogProps> = ({\n  open,\n  pod,\n  error,\n  clusterName,\n}: FixDialogProps) => {\n  const [isOpen, setOpen] = useState(!!open);\n  const classes = useStyles();\n\n  const openDialog = () => {\n    setOpen(true);\n  };\n\n  const closeDialog = () => {\n    setOpen(false);\n  };\n\n  const pf = error.proposedFix;\n\n  const dialogContent = () => {\n    return (\n      <Grid container>\n        <Grid item xs={12}>\n          <Typography variant=\"h6\">Detected error:</Typography>\n          <Typography>{error.message}</Typography>\n        </Grid>\n        <Grid item xs={12}>\n          <Typography variant=\"h6\">Cause explanation:</Typography>\n          <Typography>\n            {error.proposedFix?.rootCauseExplanation ?? 'unknown'}\n          </Typography>\n        </Grid>\n        <Grid item xs={12}>\n          <Typography variant=\"h6\">Fix:</Typography>\n          <List>\n            {(error.proposedFix?.actions ?? []).map((fix, i) => {\n              return (\n                <ListItem key={`${pod.metadata?.name ?? 'unknown'}-pf-${i}`}>\n                  {fix}\n                </ListItem>\n              );\n            })}\n          </List>\n        </Grid>\n\n        {pf && pf.type === 'logs' && (\n          <>\n            <Grid item xs={12}>\n              <Typography variant=\"h6\">Crash logs:</Typography>\n            </Grid>\n            <Grid item xs={9}>\n              <PodLogs\n                previous\n                containerScope={{\n                  podName: pod.metadata?.name ?? 'unknown',\n                  podNamespace: pod.metadata?.namespace ?? 'unknown',\n                  cluster: { name: clusterName },\n                  containerName: pf.container,\n                }}\n              />\n            </Grid>\n          </>\n        )}\n        {pf && pf.type === 'events' && (\n          <>\n            <Grid item xs={12}>\n              <Typography variant=\"h6\">Events:</Typography>\n            </Grid>\n            <Grid item xs={9}>\n              <Events\n                warningEventsOnly\n                involvedObjectName={pod.metadata?.name ?? ''}\n                namespace={pod.metadata?.namespace ?? ''}\n                clusterName={clusterName}\n              />\n            </Grid>\n          </>\n        )}\n      </Grid>\n    );\n  };\n\n  return (\n    <>\n      <Button\n        variant=\"outlined\"\n        aria-label=\"fix issue\"\n        component=\"label\"\n        onClick={openDialog}\n        startIcon={<HelpIcon />}\n      >\n        Help\n      </Button>\n      <Dialog maxWidth=\"xl\" fullWidth open={isOpen} onClose={closeDialog}>\n        <DialogTitle id=\"dialog-title\">\n          {pod.metadata?.name} - {error.type}\n          <IconButton\n            aria-label=\"close\"\n            className={classes.closeButton}\n            onClick={closeDialog}\n          >\n            <CloseIcon />\n          </IconButton>\n        </DialogTitle>\n        <DialogContent>{dialogContent()}</DialogContent>\n        <DialogActions>\n          {pf && pf.type === 'docs' && (\n            <LinkButton\n              to={pf.docsLink}\n              variant=\"outlined\"\n              startIcon={<OpenInNewIcon />}\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              Open docs\n            </LinkButton>\n          )}\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n"],"names":[],"mappings":"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"}