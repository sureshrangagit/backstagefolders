{"version":3,"file":"createGetCatalogEntityAction.cjs.js","sources":["../../src/actions/createGetCatalogEntityAction.ts"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { ActionsRegistryService } from '@backstage/backend-plugin-api/alpha';\nimport { stringifyEntityRef } from '@backstage/catalog-model';\nimport { InputError } from '@backstage/errors';\nimport { CatalogService } from '@backstage/plugin-catalog-node';\n\nexport const createGetCatalogEntityAction = ({\n  catalog,\n  actionsRegistry,\n}: {\n  catalog: CatalogService;\n  actionsRegistry: ActionsRegistryService;\n}) => {\n  actionsRegistry.register({\n    name: 'get-catalog-entity',\n    title: 'Get Catalog Entity',\n    description: `\nThis allows you to get a single entity from the software catalog.\nEach entity in the software catalog has a unique name, kind, and namespace. The default namespace is \"default\".\nEach entity is identified by a unique entity reference, which is a string of the form \"kind:namespace/name\".\n    `,\n    schema: {\n      input: z =>\n        z.object({\n          kind: z\n            .string()\n            .describe(\n              'The kind of the entity to query. If the kind is unknown it can be omitted.',\n            )\n            .optional(),\n          namespace: z\n            .string()\n            .describe(\n              'The namespace of the entity to query. If the namespace is unknown it can be omitted.',\n            )\n            .optional(),\n          name: z.string().describe('The name of the entity to query'),\n        }),\n      // TODO: is there a better way to do this?\n      output: z => z.object({}).passthrough(),\n    },\n    action: async ({ input, credentials }) => {\n      const filter: Record<string, string> = { 'metadata.name': input.name };\n\n      if (input.kind) {\n        filter.kind = input.kind;\n      }\n\n      if (input.namespace) {\n        filter['metadata.namespace'] = input.namespace;\n      }\n\n      const { items } = await catalog.queryEntities(\n        { filter },\n        {\n          credentials,\n        },\n      );\n\n      if (items.length === 0) {\n        throw new InputError(`No entity found with name \"${input.name}\"`);\n      }\n\n      if (items.length > 1) {\n        throw new Error(\n          `Multiple entities found with name \"${\n            input.name\n          }\", please provide more specific filters. Entities found: ${items\n            .map(item => `\"${stringifyEntityRef(item)}\"`)\n            .join(', ')}`,\n        );\n      }\n\n      const [entity] = items;\n\n      return {\n        output: entity,\n      };\n    },\n  });\n};\n"],"names":["InputError","stringifyEntityRef"],"mappings":";;;;;AAoBO,MAAM,+BAA+B,CAAC;AAAA,EAC3C,OAAA;AAAA,EACA;AACF,CAGM,KAAA;AACJ,EAAA,eAAA,CAAgB,QAAS,CAAA;AAAA,IACvB,IAAM,EAAA,oBAAA;AAAA,IACN,KAAO,EAAA,oBAAA;AAAA,IACP,WAAa,EAAA;AAAA;AAAA;AAAA;AAAA,IAAA,CAAA;AAAA,IAKb,MAAQ,EAAA;AAAA,MACN,KAAA,EAAO,CACL,CAAA,KAAA,CAAA,CAAE,MAAO,CAAA;AAAA,QACP,IAAA,EAAM,CACH,CAAA,MAAA,EACA,CAAA,QAAA;AAAA,UACC;AAAA,UAED,QAAS,EAAA;AAAA,QACZ,SAAA,EAAW,CACR,CAAA,MAAA,EACA,CAAA,QAAA;AAAA,UACC;AAAA,UAED,QAAS,EAAA;AAAA,QACZ,IAAM,EAAA,CAAA,CAAE,MAAO,EAAA,CAAE,SAAS,iCAAiC;AAAA,OAC5D,CAAA;AAAA;AAAA,MAEH,QAAQ,CAAK,CAAA,KAAA,CAAA,CAAE,OAAO,EAAE,EAAE,WAAY;AAAA,KACxC;AAAA,IACA,MAAQ,EAAA,OAAO,EAAE,KAAA,EAAO,aAAkB,KAAA;AACxC,MAAA,MAAM,MAAiC,GAAA,EAAE,eAAiB,EAAA,KAAA,CAAM,IAAK,EAAA;AAErE,MAAA,IAAI,MAAM,IAAM,EAAA;AACd,QAAA,MAAA,CAAO,OAAO,KAAM,CAAA,IAAA;AAAA;AAGtB,MAAA,IAAI,MAAM,SAAW,EAAA;AACnB,QAAO,MAAA,CAAA,oBAAoB,IAAI,KAAM,CAAA,SAAA;AAAA;AAGvC,MAAA,MAAM,EAAE,KAAA,EAAU,GAAA,MAAM,OAAQ,CAAA,aAAA;AAAA,QAC9B,EAAE,MAAO,EAAA;AAAA,QACT;AAAA,UACE;AAAA;AACF,OACF;AAEA,MAAI,IAAA,KAAA,CAAM,WAAW,CAAG,EAAA;AACtB,QAAA,MAAM,IAAIA,iBAAA,CAAW,CAA8B,2BAAA,EAAA,KAAA,CAAM,IAAI,CAAG,CAAA,CAAA,CAAA;AAAA;AAGlE,MAAI,IAAA,KAAA,CAAM,SAAS,CAAG,EAAA;AACpB,QAAA,MAAM,IAAI,KAAA;AAAA,UACR,CACE,mCAAA,EAAA,KAAA,CAAM,IACR,CAAA,yDAAA,EAA4D,MACzD,GAAI,CAAA,CAAA,IAAA,KAAQ,CAAI,CAAA,EAAAC,+BAAA,CAAmB,IAAI,CAAC,CAAA,CAAA,CAAG,CAC3C,CAAA,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,SACf;AAAA;AAGF,MAAM,MAAA,CAAC,MAAM,CAAI,GAAA,KAAA;AAEjB,MAAO,OAAA;AAAA,QACL,MAAQ,EAAA;AAAA,OACV;AAAA;AACF,GACD,CAAA;AACH;;;;"}