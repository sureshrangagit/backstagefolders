{"version":3,"file":"hasLabel.cjs.js","sources":["../../../src/permissions/rules/hasLabel.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { catalogEntityPermissionResourceRef } from '@backstage/plugin-catalog-node/alpha';\nimport { createPermissionRule } from '@backstage/plugin-permission-node';\nimport { z } from 'zod';\n\n/**\n * A catalog {@link @backstage/plugin-permission-node#PermissionRule} which\n * filters for entities with a specified label in its metadata.\n * @alpha\n */\nexport const hasLabel = createPermissionRule({\n  name: 'HAS_LABEL',\n  description: 'Allow entities with the specified label',\n  resourceRef: catalogEntityPermissionResourceRef,\n  paramsSchema: z.object({\n    label: z.string().describe('Name of the label to match on'),\n    value: z.string().optional().describe('Value of the label to match on'),\n  }),\n  apply: (resource, { label, value }) =>\n    !!resource.metadata.labels?.hasOwnProperty(label) &&\n    (value === undefined ? true : resource.metadata.labels?.[label] === value),\n  toQuery: ({ label, value }) =>\n    value === undefined\n      ? {\n          key: `metadata.labels.${label}`,\n        }\n      : {\n          key: `metadata.labels.${label}`,\n          values: [value],\n        },\n});\n"],"names":["createPermissionRule","catalogEntityPermissionResourceRef","z"],"mappings":";;;;;;AAyBO,MAAM,WAAWA,yCAAqB,CAAA;AAAA,EAC3C,IAAM,EAAA,WAAA;AAAA,EACN,WAAa,EAAA,yCAAA;AAAA,EACb,WAAa,EAAAC,wCAAA;AAAA,EACb,YAAA,EAAcC,MAAE,MAAO,CAAA;AAAA,IACrB,KAAO,EAAAA,KAAA,CAAE,MAAO,EAAA,CAAE,SAAS,+BAA+B,CAAA;AAAA,IAC1D,OAAOA,KAAE,CAAA,MAAA,GAAS,QAAS,EAAA,CAAE,SAAS,gCAAgC;AAAA,GACvE,CAAA;AAAA,EACD,KAAA,EAAO,CAAC,QAAU,EAAA,EAAE,OAAO,KAAM,EAAA,KAC/B,CAAC,CAAC,QAAS,CAAA,QAAA,CAAS,QAAQ,cAAe,CAAA,KAAK,MAC/C,KAAU,KAAA,KAAA,CAAA,GAAY,OAAO,QAAS,CAAA,QAAA,CAAS,MAAS,GAAA,KAAK,CAAM,KAAA,KAAA,CAAA;AAAA,EACtE,SAAS,CAAC,EAAE,OAAO,KAAM,EAAA,KACvB,UAAU,KACN,CAAA,GAAA;AAAA,IACE,GAAA,EAAK,mBAAmB,KAAK,CAAA;AAAA,GAE/B,GAAA;AAAA,IACE,GAAA,EAAK,mBAAmB,KAAK,CAAA,CAAA;AAAA,IAC7B,MAAA,EAAQ,CAAC,KAAK;AAAA;AAExB,CAAC;;;;"}