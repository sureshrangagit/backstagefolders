{"version":3,"file":"EntityListComponent.esm.js","sources":["../../../src/components/EntityListComponent/EntityListComponent.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { useApi } from '@backstage/core-plugin-api';\nimport {\n  EntityDisplayName,\n  EntityRefLink,\n  entityPresentationApiRef,\n} from '@backstage/plugin-catalog-react';\nimport Collapse from '@material-ui/core/Collapse';\nimport IconButton from '@material-ui/core/IconButton';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport { makeStyles } from '@material-ui/core/styles';\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport { ReactElement, Fragment, useState } from 'react';\n\nconst useStyles = makeStyles(theme => ({\n  nested: {\n    paddingLeft: theme.spacing(4),\n  },\n}));\n\n/**\n * Props for {@link EntityListComponent}.\n *\n * @public\n */\nexport interface EntityListComponentProps {\n  locations: Array<{\n    target: string;\n    entities: (Entity | CompoundEntityRef)[];\n  }>;\n  locationListItemIcon: (target: string) => ReactElement;\n  collapsed?: boolean;\n  firstListItem?: ReactElement;\n  onItemClick?: (target: string) => void;\n  withLinks?: boolean;\n}\n\n/**\n * Shows a result list of entities.\n *\n * @public\n */\nexport const EntityListComponent = (props: EntityListComponentProps) => {\n  const {\n    locations,\n    collapsed = false,\n    locationListItemIcon,\n    onItemClick,\n    firstListItem,\n    withLinks = false,\n  } = props;\n\n  const classes = useStyles();\n  const entityPresentationApi = useApi(entityPresentationApiRef);\n  const [expandedUrls, setExpandedUrls] = useState<string[]>([]);\n\n  const handleClick = (url: string) => {\n    setExpandedUrls(urls =>\n      urls.includes(url) ? urls.filter(u => u !== url) : urls.concat(url),\n    );\n  };\n\n  function sortEntities(entities: Array<CompoundEntityRef | Entity>) {\n    return entities.sort((a, b) =>\n      entityPresentationApi\n        .forEntity(stringifyEntityRef(a))\n        .snapshot.entityRef.localeCompare(\n          entityPresentationApi.forEntity(stringifyEntityRef(b)).snapshot\n            .entityRef,\n        ),\n    );\n  }\n\n  return (\n    <List>\n      {firstListItem}\n      {locations.map(r => (\n        <Fragment key={r.target}>\n          <ListItem\n            dense\n            button={Boolean(onItemClick) as any}\n            onClick={() => onItemClick?.(r.target)}\n          >\n            <ListItemIcon>{locationListItemIcon(r.target)}</ListItemIcon>\n\n            <ListItemText\n              primary={r.target}\n              secondary={`Entities: ${r.entities.length}`}\n            />\n\n            {collapsed && (\n              <ListItemSecondaryAction>\n                <IconButton edge=\"end\" onClick={() => handleClick(r.target)}>\n                  {expandedUrls.includes(r.target) ? (\n                    <ExpandLessIcon />\n                  ) : (\n                    <ExpandMoreIcon />\n                  )}\n                </IconButton>\n              </ListItemSecondaryAction>\n            )}\n          </ListItem>\n\n          <Collapse\n            in={!collapsed || expandedUrls.includes(r.target)}\n            timeout=\"auto\"\n            unmountOnExit\n          >\n            <List component=\"div\" disablePadding dense>\n              {sortEntities(r.entities).map(entity => {\n                return (\n                  <ListItem\n                    key={stringifyEntityRef(entity)}\n                    className={classes.nested}\n                    {...(withLinks\n                      ? {\n                          component: EntityRefLink,\n                          entityRef: entity,\n                          button: withLinks as any,\n                        }\n                      : {})}\n                  >\n                    <ListItemText\n                      primary={<EntityDisplayName entityRef={entity} />}\n                    />\n                  </ListItem>\n                );\n              })}\n            </List>\n          </Collapse>\n        </Fragment>\n      ))}\n    </List>\n  );\n};\n"],"names":[],"mappings":"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"}