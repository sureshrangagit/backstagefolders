{"version":3,"file":"StepFinishImportLocation.esm.js","sources":["../../../src/components/StepFinishImportLocation/StepFinishImportLocation.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CompoundEntityRef, DEFAULT_NAMESPACE } from '@backstage/catalog-model';\nimport { Link } from '@backstage/core-components';\nimport { useRouteRef } from '@backstage/core-plugin-api';\nimport { useTranslationRef } from '@backstage/frontend-plugin-api';\nimport { entityRouteRef } from '@backstage/plugin-catalog-react';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport LocationOnIcon from '@material-ui/icons/LocationOn';\nimport partition from 'lodash/partition';\n\nimport { catalogImportTranslationRef } from '../../translation';\nimport { BackButton, ViewComponentButton } from '../Buttons';\nimport { EntityListComponent } from '../EntityListComponent';\nimport { PrepareResult } from '../useImportState';\n\ntype Props = {\n  prepareResult: PrepareResult;\n  onReset: () => void;\n};\n\n// Among the newly registered entities, return a software entity (e.g. Component, API, Resource)\nconst filterComponentEntity = (\n  newLocations: Array<{\n    exists?: boolean;\n    target: string;\n    entities: CompoundEntityRef[];\n  }>,\n): CompoundEntityRef | null => {\n  for (const location of newLocations) {\n    for (const entity of location.entities) {\n      if (\n        ['component', 'api', 'resource'].includes(\n          entity.kind.toLocaleLowerCase('en-US'),\n        )\n      ) {\n        return {\n          kind: entity.kind.toLocaleLowerCase('en-US'),\n          namespace:\n            entity.namespace?.toLocaleLowerCase('en-US') ?? DEFAULT_NAMESPACE,\n          name: entity.name,\n        };\n      }\n    }\n  }\n\n  return null;\n};\n\nexport const StepFinishImportLocation = ({ prepareResult, onReset }: Props) => {\n  const { t } = useTranslationRef(catalogImportTranslationRef);\n  const entityRoute = useRouteRef(entityRouteRef);\n\n  if (prepareResult.type === 'repository') {\n    return (\n      <>\n        <Typography paragraph>\n          {t('stepFinishImportLocation.repository.title')}\n          <Link\n            to={prepareResult.pullRequest.url}\n            target=\"_blank\"\n            rel=\"noreferrer\"\n          >\n            {prepareResult.pullRequest.url}\n          </Link>\n        </Typography>\n        <Typography paragraph>\n          {t('stepFinishImportLocation.repository.description')}\n        </Typography>\n        <Grid container spacing={0}>\n          <BackButton onClick={onReset}>\n            {t('stepFinishImportLocation.backButtonText')}\n          </BackButton>\n        </Grid>\n      </>\n    );\n  }\n\n  const [existingLocations, newLocations] = partition(\n    prepareResult.locations,\n    l => l.exists,\n  );\n  const newComponentEntity = filterComponentEntity(newLocations);\n  return (\n    <>\n      {newLocations.length > 0 && (\n        <>\n          <Typography>{t('stepFinishImportLocation.locations.new')}</Typography>\n\n          <EntityListComponent\n            locations={newLocations}\n            locationListItemIcon={() => <LocationOnIcon />}\n            withLinks\n          />\n        </>\n      )}\n      {existingLocations.length > 0 && (\n        <>\n          <Typography>\n            {t('stepFinishImportLocation.locations.existing')}\n          </Typography>\n\n          <EntityListComponent\n            locations={existingLocations}\n            locationListItemIcon={() => <LocationOnIcon />}\n            withLinks\n          />\n        </>\n      )}\n      <Grid container spacing={0}>\n        {newComponentEntity && (\n          <ViewComponentButton to={entityRoute(newComponentEntity)}>\n            {t('stepFinishImportLocation.locations.viewButtonText')}\n          </ViewComponentButton>\n        )}\n        <BackButton onClick={onReset}>\n          {t('stepFinishImportLocation.backButtonText')}\n        </BackButton>\n      </Grid>\n    </>\n  );\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAqCA,MAAM,qBAAA,GAAwB,CAC5B,YAK6B,KAAA;AAC7B,EAAA,KAAA,MAAW,YAAY,YAAc,EAAA;AACnC,IAAW,KAAA,MAAA,MAAA,IAAU,SAAS,QAAU,EAAA;AACtC,MAAA,IACE,CAAC,WAAA,EAAa,KAAO,EAAA,UAAU,CAAE,CAAA,QAAA;AAAA,QAC/B,MAAA,CAAO,IAAK,CAAA,iBAAA,CAAkB,OAAO;AAAA,OAEvC,EAAA;AACA,QAAO,OAAA;AAAA,UACL,IAAM,EAAA,MAAA,CAAO,IAAK,CAAA,iBAAA,CAAkB,OAAO,CAAA;AAAA,UAC3C,SACE,EAAA,MAAA,CAAO,SAAW,EAAA,iBAAA,CAAkB,OAAO,CAAK,IAAA,iBAAA;AAAA,UAClD,MAAM,MAAO,CAAA;AAAA,SACf;AAAA;AACF;AACF;AAGF,EAAO,OAAA,IAAA;AACT,CAAA;AAEO,MAAM,wBAA2B,GAAA,CAAC,EAAE,aAAA,EAAe,SAAqB,KAAA;AAC7E,EAAA,MAAM,EAAE,CAAA,EAAM,GAAA,iBAAA,CAAkB,2BAA2B,CAAA;AAC3D,EAAM,MAAA,WAAA,GAAc,YAAY,cAAc,CAAA;AAE9C,EAAI,IAAA,aAAA,CAAc,SAAS,YAAc,EAAA;AACvC,IAAA,uBAEI,IAAA,CAAA,QAAA,EAAA,EAAA,QAAA,EAAA;AAAA,sBAAC,IAAA,CAAA,UAAA,EAAA,EAAW,WAAS,IAClB,EAAA,QAAA,EAAA;AAAA,QAAA,CAAA,CAAE,2CAA2C,CAAA;AAAA,wBAC9C,GAAA;AAAA,UAAC,IAAA;AAAA,UAAA;AAAA,YACC,EAAA,EAAI,cAAc,WAAY,CAAA,GAAA;AAAA,YAC9B,MAAO,EAAA,QAAA;AAAA,YACP,GAAI,EAAA,YAAA;AAAA,YAEH,wBAAc,WAAY,CAAA;AAAA;AAAA;AAC7B,OACF,EAAA,CAAA;AAAA,0BACC,UAAW,EAAA,EAAA,SAAA,EAAS,IAClB,EAAA,QAAA,EAAA,CAAA,CAAE,iDAAiD,CACtD,EAAA,CAAA;AAAA,sBACC,GAAA,CAAA,IAAA,EAAA,EAAK,SAAS,EAAA,IAAA,EAAC,OAAS,EAAA,CAAA,EACvB,QAAC,kBAAA,GAAA,CAAA,UAAA,EAAA,EAAW,OAAS,EAAA,OAAA,EAClB,QAAE,EAAA,CAAA,CAAA,yCAAyC,GAC9C,CACF,EAAA;AAAA,KACF,EAAA,CAAA;AAAA;AAIJ,EAAM,MAAA,CAAC,iBAAmB,EAAA,YAAY,CAAI,GAAA,SAAA;AAAA,IACxC,aAAc,CAAA,SAAA;AAAA,IACd,OAAK,CAAE,CAAA;AAAA,GACT;AACA,EAAM,MAAA,kBAAA,GAAqB,sBAAsB,YAAY,CAAA;AAC7D,EAAA,uBAEK,IAAA,CAAA,QAAA,EAAA,EAAA,QAAA,EAAA;AAAA,IAAa,YAAA,CAAA,MAAA,GAAS,qBAEnB,IAAA,CAAA,QAAA,EAAA,EAAA,QAAA,EAAA;AAAA,sBAAC,GAAA,CAAA,UAAA,EAAA,EAAY,QAAE,EAAA,CAAA,CAAA,wCAAwC,CAAE,EAAA,CAAA;AAAA,sBAEzD,GAAA;AAAA,QAAC,mBAAA;AAAA,QAAA;AAAA,UACC,SAAW,EAAA,YAAA;AAAA,UACX,oBAAA,EAAsB,sBAAM,GAAA,CAAC,cAAe,EAAA,EAAA,CAAA;AAAA,UAC5C,SAAS,EAAA;AAAA;AAAA;AACX,KACF,EAAA,CAAA;AAAA,IAED,iBAAA,CAAkB,MAAS,GAAA,CAAA,oBAExB,IAAA,CAAA,QAAA,EAAA,EAAA,QAAA,EAAA;AAAA,sBAAC,GAAA,CAAA,UAAA,EAAA,EACE,QAAE,EAAA,CAAA,CAAA,6CAA6C,CAClD,EAAA,CAAA;AAAA,sBAEA,GAAA;AAAA,QAAC,mBAAA;AAAA,QAAA;AAAA,UACC,SAAW,EAAA,iBAAA;AAAA,UACX,oBAAA,EAAsB,sBAAM,GAAA,CAAC,cAAe,EAAA,EAAA,CAAA;AAAA,UAC5C,SAAS,EAAA;AAAA;AAAA;AACX,KACF,EAAA,CAAA;AAAA,oBAED,IAAA,CAAA,IAAA,EAAA,EAAK,SAAS,EAAA,IAAA,EAAC,SAAS,CACtB,EAAA,QAAA,EAAA;AAAA,MACC,kBAAA,oBAAA,GAAA,CAAC,uBAAoB,EAAI,EAAA,WAAA,CAAY,kBAAkB,CACpD,EAAA,QAAA,EAAA,CAAA,CAAE,mDAAmD,CACxD,EAAA,CAAA;AAAA,0BAED,UAAW,EAAA,EAAA,OAAA,EAAS,OAClB,EAAA,QAAA,EAAA,CAAA,CAAE,yCAAyC,CAC9C,EAAA;AAAA,KACF,EAAA;AAAA,GACF,EAAA,CAAA;AAEJ;;;;"}