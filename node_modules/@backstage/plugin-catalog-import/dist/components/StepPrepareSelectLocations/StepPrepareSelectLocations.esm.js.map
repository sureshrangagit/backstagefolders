{"version":3,"file":"StepPrepareSelectLocations.esm.js","sources":["../../../src/components/StepPrepareSelectLocations/StepPrepareSelectLocations.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useTranslationRef } from '@backstage/frontend-plugin-api';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport Grid from '@material-ui/core/Grid';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Typography from '@material-ui/core/Typography';\nimport LocationOnIcon from '@material-ui/icons/LocationOn';\nimport partition from 'lodash/partition';\nimport { useCallback, useState } from 'react';\n\nimport { AnalyzeResult } from '../../api';\nimport { catalogImportTranslationRef } from '../../translation';\nimport { BackButton, NextButton } from '../Buttons';\nimport { EntityListComponent } from '../EntityListComponent';\nimport { PrepareResult } from '../useImportState';\n\ntype Props = {\n  analyzeResult: Extract<AnalyzeResult, { type: 'locations' }>;\n  prepareResult?: PrepareResult;\n  onPrepare: (result: PrepareResult) => void;\n  onGoBack?: () => void;\n};\n\n/**\n * A form that lets a user select one of a list of locations to import\n *\n * @param analyzeResult - the result of the analysis\n * @param prepareResult - the selectected locations from a previous step\n * @param onPrepare - called after the selection\n * @param onGoBack - called to go back to the previous step\n */\nexport const StepPrepareSelectLocations = ({\n  analyzeResult,\n  prepareResult,\n  onPrepare,\n  onGoBack,\n}: Props) => {\n  const { t } = useTranslationRef(catalogImportTranslationRef);\n\n  const [selectedUrls, setSelectedUrls] = useState<string[]>(\n    prepareResult?.locations.map(l => l.target) || [],\n  );\n\n  const [existingLocations, locations] = partition(\n    analyzeResult?.locations,\n    l => l.exists,\n  );\n\n  const handleResult = useCallback(async () => {\n    onPrepare({\n      type: 'locations',\n      locations: locations.filter((l: any) => selectedUrls.includes(l.target)),\n    });\n  }, [locations, onPrepare, selectedUrls]);\n\n  const onItemClick = (url: string) => {\n    setSelectedUrls(urls =>\n      urls.includes(url) ? urls.filter(u => u !== url) : urls.concat(url),\n    );\n  };\n\n  const onSelectAll = () => {\n    setSelectedUrls(urls =>\n      urls.length < locations.length ? locations.map(l => l.target) : [],\n    );\n  };\n\n  return (\n    <>\n      {locations.length > 0 && (\n        <>\n          <Typography>\n            {t('stepPrepareSelectLocations.locations.description')}\n          </Typography>\n          <EntityListComponent\n            firstListItem={\n              <ListItem dense button onClick={onSelectAll}>\n                <ListItemIcon>\n                  <Checkbox\n                    edge=\"start\"\n                    checked={selectedUrls.length === locations.length}\n                    indeterminate={\n                      selectedUrls.length > 0 &&\n                      selectedUrls.length < locations.length\n                    }\n                    tabIndex={-1}\n                    disableRipple\n                  />\n                </ListItemIcon>\n                <ListItemText\n                  primary={t('stepPrepareSelectLocations.locations.selectAll')}\n                />\n              </ListItem>\n            }\n            onItemClick={onItemClick}\n            locations={locations}\n            locationListItemIcon={target => (\n              <Checkbox\n                edge=\"start\"\n                checked={selectedUrls.includes(target)}\n                tabIndex={-1}\n                disableRipple\n              />\n            )}\n            collapsed\n          />\n        </>\n      )}\n\n      {existingLocations.length > 0 && (\n        <>\n          <Typography>\n            {t('stepPrepareSelectLocations.existingLocations.description')}\n          </Typography>\n          <EntityListComponent\n            locations={existingLocations}\n            locationListItemIcon={() => <LocationOnIcon />}\n            withLinks\n            collapsed\n          />\n        </>\n      )}\n\n      <Grid container spacing={0}>\n        {onGoBack && <BackButton onClick={onGoBack} />}\n        <NextButton disabled={selectedUrls.length === 0} onClick={handleResult}>\n          {t('stepPrepareSelectLocations.nextButtonText')}\n        </NextButton>\n      </Grid>\n    </>\n  );\n};\n"],"names":[],"mappings":"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"}