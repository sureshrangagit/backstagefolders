{"version":3,"file":"createSpecializedApp.esm.js","sources":["../../src/wiring/createSpecializedApp.tsx"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ConfigReader } from '@backstage/config';\nimport {\n  ApiBlueprint,\n  AppTree,\n  AppTreeApi,\n  appTreeApiRef,\n  RouteRef,\n  ExternalRouteRef,\n  SubRouteRef,\n  AnyRouteRefParams,\n  RouteFunc,\n  RouteResolutionApiResolveOptions,\n  RouteResolutionApi,\n  createApiFactory,\n  routeResolutionApiRef,\n  AppNode,\n  ExtensionFactoryMiddleware,\n  FrontendFeature,\n} from '@backstage/frontend-plugin-api';\nimport {\n  AnyApiFactory,\n  ApiHolder,\n  ConfigApi,\n  configApiRef,\n  featureFlagsApiRef,\n  identityApiRef,\n} from '@backstage/core-plugin-api';\nimport { ApiFactoryRegistry, ApiResolver } from '@backstage/core-app-api';\nimport {\n  createExtensionDataContainer,\n  OpaqueFrontendPlugin,\n} from '@internal/frontend';\n\n// eslint-disable-next-line @backstage/no-relative-monorepo-imports\nimport {\n  resolveExtensionDefinition,\n  toInternalExtension,\n} from '../../../frontend-plugin-api/src/wiring/resolveExtensionDefinition';\n\nimport { extractRouteInfoFromAppNode } from '../routing/extractRouteInfoFromAppNode';\n\nimport { CreateAppRouteBinder } from '../routing';\nimport { RouteResolver } from '../routing/RouteResolver';\nimport { resolveRouteBindings } from '../routing/resolveRouteBindings';\nimport { collectRouteIds } from '../routing/collectRouteIds';\n// eslint-disable-next-line @backstage/no-relative-monorepo-imports\nimport {\n  toInternalFrontendModule,\n  isInternalFrontendModule,\n} from '../../../frontend-plugin-api/src/wiring/createFrontendModule';\nimport { getBasePath } from '../routing/getBasePath';\nimport { Root } from '../extensions/Root';\nimport { resolveAppTree } from '../tree/resolveAppTree';\nimport { resolveAppNodeSpecs } from '../tree/resolveAppNodeSpecs';\nimport { readAppExtensionsConfig } from '../tree/readAppExtensionsConfig';\nimport { instantiateAppNodeTree } from '../tree/instantiateAppNodeTree';\n// eslint-disable-next-line @backstage/no-relative-monorepo-imports\nimport { ApiRegistry } from '../../../core-app-api/src/apis/system/ApiRegistry';\n// eslint-disable-next-line @backstage/no-relative-monorepo-imports\nimport { AppIdentityProxy } from '../../../core-app-api/src/apis/implementations/IdentityApi/AppIdentityProxy';\nimport { BackstageRouteObject } from '../routing/types';\nimport { RouteInfo } from './types';\nimport { matchRoutes } from 'react-router-dom';\nimport {\n  createPluginInfoAttacher,\n  FrontendPluginInfoResolver,\n} from './createPluginInfoAttacher';\n\nfunction deduplicateFeatures(\n  allFeatures: FrontendFeature[],\n): FrontendFeature[] {\n  // Start by removing duplicates by reference\n  const features = Array.from(new Set(allFeatures));\n\n  // Plugins are deduplicated by ID, last one wins\n  const seenIds = new Set<string>();\n  return features\n    .reverse()\n    .filter(feature => {\n      if (!OpaqueFrontendPlugin.isType(feature)) {\n        return true;\n      }\n      if (seenIds.has(feature.id)) {\n        return false;\n      }\n      seenIds.add(feature.id);\n      return true;\n    })\n    .reverse();\n}\n\n// Helps delay callers from reaching out to the API before the app tree has been materialized\nclass AppTreeApiProxy implements AppTreeApi {\n  #routeInfo?: RouteInfo;\n\n  constructor(\n    private readonly tree: AppTree,\n    private readonly appBasePath: string,\n  ) {}\n\n  private checkIfInitialized() {\n    if (!this.#routeInfo) {\n      throw new Error(\n        `You can't access the AppTreeApi during initialization of the app tree. Please move occurrences of this out of the initialization of the factory`,\n      );\n    }\n  }\n\n  getTree() {\n    this.checkIfInitialized();\n\n    return { tree: this.tree };\n  }\n\n  getNodesByRoutePath(sourcePath: string): { nodes: AppNode[] } {\n    this.checkIfInitialized();\n\n    let path = sourcePath;\n    if (path.startsWith(this.appBasePath)) {\n      path = path.slice(this.appBasePath.length);\n    }\n\n    const matchedRoutes = matchRoutes(this.#routeInfo!.routeObjects, path);\n\n    const matchedAppNodes =\n      matchedRoutes\n        ?.filter(routeObj => !!routeObj.route.appNode)\n        .map(routeObj => routeObj.route.appNode!) || [];\n\n    return { nodes: matchedAppNodes };\n  }\n\n  initialize(routeInfo: RouteInfo) {\n    this.#routeInfo = routeInfo;\n  }\n}\n\n// Helps delay callers from reaching out to the API before the app tree has been materialized\nclass RouteResolutionApiProxy implements RouteResolutionApi {\n  #delegate: RouteResolutionApi | undefined;\n  #routeObjects: BackstageRouteObject[] | undefined;\n\n  constructor(\n    private readonly routeBindings: Map<\n      ExternalRouteRef,\n      RouteRef | SubRouteRef\n    >,\n    private readonly appBasePath: string,\n  ) {}\n\n  resolve<TParams extends AnyRouteRefParams>(\n    anyRouteRef:\n      | RouteRef<TParams>\n      | SubRouteRef<TParams>\n      | ExternalRouteRef<TParams>,\n    options?: RouteResolutionApiResolveOptions,\n  ): RouteFunc<TParams> | undefined {\n    if (!this.#delegate) {\n      throw new Error(\n        `You can't access the RouteResolver during initialization of the app tree. Please move occurrences of this out of the initialization of the factory`,\n      );\n    }\n\n    return this.#delegate.resolve(anyRouteRef, options);\n  }\n\n  initialize(routeInfo: RouteInfo) {\n    this.#delegate = new RouteResolver(\n      routeInfo.routePaths,\n      routeInfo.routeParents,\n      routeInfo.routeObjects,\n      this.routeBindings,\n      this.appBasePath,\n    );\n    this.#routeObjects = routeInfo.routeObjects;\n\n    return routeInfo;\n  }\n\n  getRouteObjects() {\n    return this.#routeObjects;\n  }\n}\n\n/**\n * Creates an empty app without any default features. This is a low-level API is\n * intended for use in tests or specialized setups. Typically you want to use\n * `createApp` from `@backstage/frontend-defaults` instead.\n *\n * @public\n */\nexport function createSpecializedApp(options?: {\n  features?: FrontendFeature[];\n  config?: ConfigApi;\n  bindRoutes?(context: { bind: CreateAppRouteBinder }): void;\n  apis?: ApiHolder;\n  extensionFactoryMiddleware?:\n    | ExtensionFactoryMiddleware\n    | ExtensionFactoryMiddleware[];\n  flags?: { allowUnknownExtensionConfig?: boolean };\n  pluginInfoResolver?: FrontendPluginInfoResolver;\n}): { apis: ApiHolder; tree: AppTree } {\n  const config = options?.config ?? new ConfigReader({}, 'empty-config');\n  const features = deduplicateFeatures(options?.features ?? []).map(\n    createPluginInfoAttacher(config, options?.pluginInfoResolver),\n  );\n\n  const tree = resolveAppTree(\n    'root',\n    resolveAppNodeSpecs({\n      features,\n      builtinExtensions: [\n        resolveExtensionDefinition(Root, { namespace: 'root' }),\n      ],\n      parameters: readAppExtensionsConfig(config),\n      forbidden: new Set(['root']),\n      allowUnknownExtensionConfig: options?.flags?.allowUnknownExtensionConfig,\n    }),\n  );\n\n  const factories = createApiFactories({ tree });\n  const appBasePath = getBasePath(config);\n  const appTreeApi = new AppTreeApiProxy(tree, appBasePath);\n  const routeResolutionApi = new RouteResolutionApiProxy(\n    resolveRouteBindings(\n      options?.bindRoutes,\n      config,\n      collectRouteIds(features),\n    ),\n    appBasePath,\n  );\n\n  const appIdentityProxy = new AppIdentityProxy();\n  const apis =\n    options?.apis ??\n    createApiHolder({\n      factories,\n      staticFactories: [\n        createApiFactory(appTreeApiRef, appTreeApi),\n        createApiFactory(configApiRef, config),\n        createApiFactory(routeResolutionApiRef, routeResolutionApi),\n        createApiFactory(identityApiRef, appIdentityProxy),\n      ],\n    });\n\n  const featureFlagApi = apis.get(featureFlagsApiRef);\n  if (featureFlagApi) {\n    for (const feature of features) {\n      if (OpaqueFrontendPlugin.isType(feature)) {\n        OpaqueFrontendPlugin.toInternal(feature).featureFlags.forEach(flag =>\n          featureFlagApi.registerFlag({\n            name: flag.name,\n            pluginId: feature.id,\n          }),\n        );\n      }\n      if (isInternalFrontendModule(feature)) {\n        toInternalFrontendModule(feature).featureFlags.forEach(flag =>\n          featureFlagApi.registerFlag({\n            name: flag.name,\n            pluginId: feature.pluginId,\n          }),\n        );\n      }\n    }\n  }\n\n  // Now instantiate the entire tree, which will skip anything that's already been instantiated\n  instantiateAppNodeTree(\n    tree.root,\n    apis,\n    mergeExtensionFactoryMiddleware(options?.extensionFactoryMiddleware),\n  );\n\n  const routeInfo = extractRouteInfoFromAppNode(tree.root);\n\n  routeResolutionApi.initialize(routeInfo);\n  appTreeApi.initialize(routeInfo);\n\n  return { apis, tree };\n}\n\nfunction createApiFactories(options: { tree: AppTree }): AnyApiFactory[] {\n  const emptyApiHolder = ApiRegistry.from([]);\n  const factories = new Array<AnyApiFactory>();\n\n  for (const apiNode of options.tree.root.edges.attachments.get('apis') ?? []) {\n    instantiateAppNodeTree(apiNode, emptyApiHolder);\n    const apiFactory = apiNode.instance?.getData(ApiBlueprint.dataRefs.factory);\n    if (!apiFactory) {\n      throw new Error(\n        `No API factory found in for extension ${apiNode.spec.id}`,\n      );\n    }\n    factories.push(apiFactory);\n  }\n\n  return factories;\n}\n\nfunction createApiHolder(options: {\n  factories: AnyApiFactory[];\n  staticFactories: AnyApiFactory[];\n}): ApiHolder {\n  const factoryRegistry = new ApiFactoryRegistry();\n\n  for (const factory of options.factories.slice().reverse()) {\n    factoryRegistry.register('default', factory);\n  }\n\n  for (const factory of options.staticFactories) {\n    factoryRegistry.register('static', factory);\n  }\n\n  ApiResolver.validateFactories(factoryRegistry, factoryRegistry.getAllApis());\n\n  return new ApiResolver(factoryRegistry);\n}\n\nfunction mergeExtensionFactoryMiddleware(\n  middlewares?: ExtensionFactoryMiddleware | ExtensionFactoryMiddleware[],\n): ExtensionFactoryMiddleware | undefined {\n  if (!middlewares) {\n    return undefined;\n  }\n  if (!Array.isArray(middlewares)) {\n    return middlewares;\n  }\n  if (middlewares.length <= 1) {\n    return middlewares[0];\n  }\n  return middlewares.reduce((prev, next) => {\n    if (!prev || !next) {\n      return prev ?? next;\n    }\n    return (orig, ctx) => {\n      const internalExt = toInternalExtension(ctx.node.spec.extension);\n      if (internalExt.version !== 'v2') {\n        return orig();\n      }\n      return next(ctxOverrides => {\n        return createExtensionDataContainer(\n          prev(orig, {\n            node: ctx.node,\n            apis: ctx.apis,\n            config: ctxOverrides?.config ?? ctx.config,\n          }),\n        );\n      }, ctx);\n    };\n  });\n}\n"],"names":[],"mappings":"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"}