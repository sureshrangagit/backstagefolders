{"version":3,"file":"ExpandableNavigation.esm.js","sources":["../../src/ExpandableNavigation/ExpandableNavigation.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useCallback, useState } from 'react';\nimport { useLocalStorageValue } from '@react-hookz/web';\nimport { Button, withStyles } from '@material-ui/core';\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\n\nimport { useShadowRootElements } from '@backstage/plugin-techdocs-react';\n\nconst NESTED_LIST_TOGGLE = '.md-nav__item--nested .md-toggle';\n\nconst EXPANDABLE_NAVIGATION_LOCAL_STORAGE =\n  '@backstage/techdocs-addons/nav-expanded';\n\nconst StyledButton = withStyles({\n  root: {\n    position: 'absolute',\n    left: '13.7rem', // Sidebar inner width (15.1em) minus the different margins/paddings\n    top: '19px',\n    zIndex: 2,\n    padding: 0,\n    minWidth: 0,\n  },\n})(Button);\n\nconst CollapsedIcon = withStyles({\n  root: {\n    height: '20px',\n    width: '20px',\n  },\n})(ChevronRightIcon);\n\nconst ExpandedIcon = withStyles({\n  root: {\n    height: '20px',\n    width: '20px',\n  },\n})(ExpandMoreIcon);\n\ntype expandableNavigationLocalStorage = {\n  expandAllNestedNavs: boolean;\n};\n\n/**\n * Show expand/collapse navigation button next to site name in main\n * navigation menu if documentation site has nested navigation.\n */\nexport const ExpandableNavigationAddon = () => {\n  const defaultValue = { expandAllNestedNavs: false };\n  const { value: expanded, set: setExpanded } =\n    useLocalStorageValue<expandableNavigationLocalStorage>(\n      EXPANDABLE_NAVIGATION_LOCAL_STORAGE,\n      { defaultValue },\n    );\n  const [hasNavSubLevels, setHasNavSubLevels] = useState<boolean>(false);\n\n  const [...checkboxToggles] = useShadowRootElements<HTMLInputElement>([\n    NESTED_LIST_TOGGLE,\n  ]);\n\n  const shouldToggle = useCallback(\n    (item: HTMLInputElement) => {\n      const isExpanded = item.checked;\n      const shouldExpand = expanded?.expandAllNestedNavs;\n\n      // Is collapsed but should expand\n      if (shouldExpand && !isExpanded) {\n        return true;\n      }\n\n      // Is expanded but should collapse\n      if (!shouldExpand && isExpanded) {\n        return true;\n      }\n\n      return false;\n    },\n    [expanded],\n  );\n  const handleKeyPass = (\n    event: React.KeyboardEvent<HTMLElement>,\n    toggleAction: () => void,\n  ) => {\n    if (event.key === 'Enter' || event.key === ' ') {\n      event.preventDefault();\n      toggleAction();\n    }\n  };\n  useEffect(() => {\n    // There is no nested navs\n    if (!checkboxToggles?.length) return;\n\n    setHasNavSubLevels(true);\n    checkboxToggles.forEach(item => {\n      item.tabIndex = 0;\n      const toggleAction = () => {\n        if (shouldToggle(item)) {\n          item.click();\n        }\n      };\n      // Add keyboard event listener\n      const keydownHandler = (event: KeyboardEvent) => {\n        handleKeyPass(\n          event as unknown as React.KeyboardEvent<HTMLDivElement>,\n          toggleAction,\n        );\n      };\n      item.addEventListener('keydown', keydownHandler);\n      item.addEventListener('click', toggleAction);\n\n      // Clean up event listener or unmount\n      return () => {\n        item.removeEventListener('keydown', keydownHandler);\n        item.removeEventListener('click', toggleAction);\n      };\n    });\n  }, [checkboxToggles, shouldToggle]);\n  useEffect(() => {\n    if (!checkboxToggles?.length) return;\n    checkboxToggles.forEach(item => {\n      if (shouldToggle(item)) {\n        item.click();\n      }\n    });\n  }, [expanded, checkboxToggles, shouldToggle]);\n\n  const handleState = () => {\n    setExpanded(prevState => ({\n      expandAllNestedNavs: !prevState?.expandAllNestedNavs,\n    }));\n  };\n\n  return (\n    <>\n      {hasNavSubLevels ? (\n        <StyledButton\n          size=\"small\"\n          onClick={handleState}\n          onKeyDown={event => handleKeyPass(event, handleState)}\n          tabIndex={0} // Ensuring keyboard focus\n          aria-expanded={expanded?.expandAllNestedNavs} // Accessibility\n          aria-label={\n            expanded?.expandAllNestedNavs ? 'collapse-nav' : 'expand-nav'\n          }\n        >\n          {expanded?.expandAllNestedNavs ? <ExpandedIcon /> : <CollapsedIcon />}\n        </StyledButton>\n      ) : null}\n    </>\n  );\n};\n"],"names":[],"mappings":"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"}