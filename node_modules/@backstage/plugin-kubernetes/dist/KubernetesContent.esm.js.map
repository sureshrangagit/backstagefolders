{"version":3,"file":"KubernetesContent.esm.js","sources":["../src/KubernetesContent.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ReactNode } from 'react';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport { Entity } from '@backstage/catalog-model';\nimport {\n  ErrorPanel,\n  ErrorReporting,\n  Cluster,\n  useKubernetesObjects,\n  DetectedErrorsContext,\n} from '@backstage/plugin-kubernetes-react';\nimport {\n  DetectedError,\n  detectErrors,\n} from '@backstage/plugin-kubernetes-common';\nimport {\n  Content,\n  EmptyState,\n  Page,\n  Progress,\n} from '@backstage/core-components';\nimport { RequireKubernetesPermissions } from './RequireKubernetesPermissions';\n\ntype KubernetesContentProps = {\n  entity: Entity;\n  refreshIntervalMs?: number;\n  children?: ReactNode;\n};\n\nexport const KubernetesContent = ({\n  entity,\n  refreshIntervalMs,\n}: KubernetesContentProps) => {\n  const { kubernetesObjects, error } = useKubernetesObjects(\n    entity,\n    refreshIntervalMs,\n  );\n\n  const clusters = kubernetesObjects?.items.map(item => item.cluster) ?? [];\n\n  const clustersWithErrors =\n    kubernetesObjects?.items.filter(r => r.errors.length > 0) ?? [];\n\n  const detectedErrors =\n    kubernetesObjects !== undefined\n      ? detectErrors(kubernetesObjects)\n      : new Map<string, DetectedError[]>();\n\n  return (\n    <Page themeId=\"tool\">\n      <Content>\n        <RequireKubernetesPermissions>\n          <DetectedErrorsContext.Provider\n            value={[...detectedErrors.values()].flat()}\n          >\n            {kubernetesObjects === undefined && error === undefined && (\n              <Progress />\n            )}\n\n            {/* errors retrieved from the kubernetes clusters */}\n            {clustersWithErrors.length > 0 && (\n              <Grid container spacing={3} direction=\"column\">\n                <Grid item>\n                  <ErrorPanel\n                    entityName={entity.metadata.name}\n                    clustersWithErrors={clustersWithErrors}\n                  />\n                </Grid>\n              </Grid>\n            )}\n\n            {/* other errors */}\n            {error !== undefined && (\n              <Grid container spacing={3} direction=\"column\">\n                <Grid item>\n                  <ErrorPanel\n                    entityName={entity.metadata.name}\n                    errorMessage={error}\n                  />\n                </Grid>\n              </Grid>\n            )}\n\n            {kubernetesObjects && (\n              <Grid container spacing={3} direction=\"column\">\n                <Grid item>\n                  <ErrorReporting\n                    detectedErrors={detectedErrors}\n                    clusters={clusters}\n                  />\n                </Grid>\n                <Grid item>\n                  <Typography variant=\"h3\">Your Clusters</Typography>\n                </Grid>\n                <Grid item container>\n                  {kubernetesObjects?.items.length <= 0 && (\n                    <Grid\n                      container\n                      justifyContent=\"space-around\"\n                      direction=\"row\"\n                      alignItems=\"center\"\n                      spacing={2}\n                    >\n                      <Grid item xs={8}>\n                        <EmptyState\n                          missing=\"data\"\n                          title=\"No Kubernetes resources\"\n                          description={`No resources on any known clusters for ${entity.metadata.name}`}\n                        />\n                      </Grid>\n                    </Grid>\n                  )}\n                  {kubernetesObjects?.items.length > 0 &&\n                    kubernetesObjects?.items.map((item, i) => {\n                      const podsWithErrors = new Set<string>(\n                        detectedErrors\n                          .get(item.cluster.name)\n                          ?.filter(de => de.sourceRef.kind === 'Pod')\n                          .map(de => de.sourceRef.name),\n                      );\n\n                      return (\n                        <Grid item key={i} xs={12}>\n                          <Cluster\n                            clusterObjects={item}\n                            podsWithErrors={podsWithErrors}\n                          />\n                        </Grid>\n                      );\n                    })}\n                </Grid>\n              </Grid>\n            )}\n          </DetectedErrorsContext.Provider>\n        </RequireKubernetesPermissions>\n      </Content>\n    </Page>\n  );\n};\n"],"names":[],"mappings":";;;;;;;;AA6CO,MAAM,oBAAoB,CAAC;AAAA,EAChC,MAAA;AAAA,EACA;AACF,CAA8B,KAAA;AAC5B,EAAM,MAAA,EAAE,iBAAmB,EAAA,KAAA,EAAU,GAAA,oBAAA;AAAA,IACnC,MAAA;AAAA,IACA;AAAA,GACF;AAEA,EAAM,MAAA,QAAA,GAAW,mBAAmB,KAAM,CAAA,GAAA,CAAI,UAAQ,IAAK,CAAA,OAAO,KAAK,EAAC;AAExE,EAAM,MAAA,kBAAA,GACJ,iBAAmB,EAAA,KAAA,CAAM,MAAO,CAAA,CAAA,CAAA,KAAK,EAAE,MAAO,CAAA,MAAA,GAAS,CAAC,CAAA,IAAK,EAAC;AAEhE,EAAA,MAAM,iBACJ,iBAAsB,KAAA,KAAA,CAAA,GAClB,aAAa,iBAAiB,CAAA,uBAC1B,GAA6B,EAAA;AAEvC,EAAA,2BACG,IAAK,EAAA,EAAA,OAAA,EAAQ,QACZ,QAAC,kBAAA,GAAA,CAAA,OAAA,EAAA,EACC,8BAAC,4BACC,EAAA,EAAA,QAAA,kBAAA,IAAA;AAAA,IAAC,qBAAsB,CAAA,QAAA;AAAA,IAAtB;AAAA,MACC,OAAO,CAAC,GAAG,eAAe,MAAO,EAAC,EAAE,IAAK,EAAA;AAAA,MAExC,QAAA,EAAA;AAAA,QAAA,iBAAA,KAAsB,KAAa,CAAA,IAAA,KAAA,KAAU,KAC5C,CAAA,oBAAA,GAAA,CAAC,QAAS,EAAA,EAAA,CAAA;AAAA,QAIX,kBAAmB,CAAA,MAAA,GAAS,CAC3B,oBAAA,GAAA,CAAC,QAAK,SAAS,EAAA,IAAA,EAAC,OAAS,EAAA,CAAA,EAAG,SAAU,EAAA,QAAA,EACpC,QAAC,kBAAA,GAAA,CAAA,IAAA,EAAA,EAAK,MAAI,IACR,EAAA,QAAA,kBAAA,GAAA;AAAA,UAAC,UAAA;AAAA,UAAA;AAAA,YACC,UAAA,EAAY,OAAO,QAAS,CAAA,IAAA;AAAA,YAC5B;AAAA;AAAA,WAEJ,CACF,EAAA,CAAA;AAAA,QAID,KAAU,KAAA,KAAA,CAAA,oBACR,GAAA,CAAA,IAAA,EAAA,EAAK,SAAS,EAAA,IAAA,EAAC,OAAS,EAAA,CAAA,EAAG,SAAU,EAAA,QAAA,EACpC,QAAC,kBAAA,GAAA,CAAA,IAAA,EAAA,EAAK,MAAI,IACR,EAAA,QAAA,kBAAA,GAAA;AAAA,UAAC,UAAA;AAAA,UAAA;AAAA,YACC,UAAA,EAAY,OAAO,QAAS,CAAA,IAAA;AAAA,YAC5B,YAAc,EAAA;AAAA;AAAA,WAElB,CACF,EAAA,CAAA;AAAA,QAGD,iBAAA,yBACE,IAAK,EAAA,EAAA,SAAA,EAAS,MAAC,OAAS,EAAA,CAAA,EAAG,WAAU,QACpC,EAAA,QAAA,EAAA;AAAA,0BAAC,GAAA,CAAA,IAAA,EAAA,EAAK,MAAI,IACR,EAAA,QAAA,kBAAA,GAAA;AAAA,YAAC,cAAA;AAAA,YAAA;AAAA,cACC,cAAA;AAAA,cACA;AAAA;AAAA,WAEJ,EAAA,CAAA;AAAA,0BACA,GAAA,CAAC,QAAK,IAAI,EAAA,IAAA,EACR,8BAAC,UAAW,EAAA,EAAA,OAAA,EAAQ,IAAK,EAAA,QAAA,EAAA,eAAA,EAAa,CACxC,EAAA,CAAA;AAAA,0BACC,IAAA,CAAA,IAAA,EAAA,EAAK,IAAI,EAAA,IAAA,EAAC,WAAS,IACjB,EAAA,QAAA,EAAA;AAAA,YAAmB,iBAAA,EAAA,KAAA,CAAM,UAAU,CAClC,oBAAA,GAAA;AAAA,cAAC,IAAA;AAAA,cAAA;AAAA,gBACC,SAAS,EAAA,IAAA;AAAA,gBACT,cAAe,EAAA,cAAA;AAAA,gBACf,SAAU,EAAA,KAAA;AAAA,gBACV,UAAW,EAAA,QAAA;AAAA,gBACX,OAAS,EAAA,CAAA;AAAA,gBAET,QAAC,kBAAA,GAAA,CAAA,IAAA,EAAA,EAAK,IAAI,EAAA,IAAA,EAAC,IAAI,CACb,EAAA,QAAA,kBAAA,GAAA;AAAA,kBAAC,UAAA;AAAA,kBAAA;AAAA,oBACC,OAAQ,EAAA,MAAA;AAAA,oBACR,KAAM,EAAA,yBAAA;AAAA,oBACN,WAAa,EAAA,CAAA,uCAAA,EAA0C,MAAO,CAAA,QAAA,CAAS,IAAI,CAAA;AAAA;AAAA,iBAE/E,EAAA;AAAA;AAAA,aACF;AAAA,YAED,iBAAA,EAAmB,MAAM,MAAS,GAAA,CAAA,IACjC,mBAAmB,KAAM,CAAA,GAAA,CAAI,CAAC,IAAA,EAAM,CAAM,KAAA;AACxC,cAAA,MAAM,iBAAiB,IAAI,GAAA;AAAA,gBACzB,eACG,GAAI,CAAA,IAAA,CAAK,OAAQ,CAAA,IAAI,GACpB,MAAO,CAAA,CAAA,EAAA,KAAM,EAAG,CAAA,SAAA,CAAU,SAAS,KAAK,CAAA,CACzC,IAAI,CAAM,EAAA,KAAA,EAAA,CAAG,UAAU,IAAI;AAAA,eAChC;AAEA,cAAA,uBACG,GAAA,CAAA,IAAA,EAAA,EAAK,IAAI,EAAA,IAAA,EAAS,IAAI,EACrB,EAAA,QAAA,kBAAA,GAAA;AAAA,gBAAC,OAAA;AAAA,gBAAA;AAAA,kBACC,cAAgB,EAAA,IAAA;AAAA,kBAChB;AAAA;AAAA,mBAHY,CAKhB,CAAA;AAAA,aAEH;AAAA,WACL,EAAA;AAAA,SACF,EAAA;AAAA;AAAA;AAAA,GAEJ,EACF,GACF,CACF,EAAA,CAAA;AAEJ;;;;"}