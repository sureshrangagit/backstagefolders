{"version":3,"file":"ProviderSettingsItem.esm.js","sources":["../../../src/components/AuthProviders/ProviderSettingsItem.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useState } from 'react';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Typography from '@material-ui/core/Typography';\nimport {\n  ApiRef,\n  SessionApi,\n  SessionState,\n  ProfileInfoApi,\n  ProfileInfo,\n  useApi,\n  errorApiRef,\n  IconComponent,\n} from '@backstage/core-plugin-api';\nimport { ProviderSettingsAvatar } from './ProviderSettingsAvatar';\nimport { useTranslationRef } from '@backstage/frontend-plugin-api';\nimport { userSettingsTranslationRef } from '../../translation';\n\nconst emptyProfile: ProfileInfo = {};\n\n/** @public */\nexport const ProviderSettingsItem = (props: {\n  title: string;\n  description: string;\n  icon: IconComponent;\n  apiRef: ApiRef<ProfileInfoApi & SessionApi>;\n}) => {\n  const { title, description, icon: Icon, apiRef } = props;\n\n  const api = useApi(apiRef);\n  const errorApi = useApi(errorApiRef);\n  const [signedIn, setSignedIn] = useState(false);\n  const [profile, setProfile] = useState<ProfileInfo>(emptyProfile);\n  const { t } = useTranslationRef(userSettingsTranslationRef);\n\n  useEffect(() => {\n    let didCancel = false;\n\n    const subscription = api\n      .sessionState$()\n      .subscribe((sessionState: SessionState) => {\n        if (sessionState !== SessionState.SignedIn) {\n          setProfile(emptyProfile);\n          setSignedIn(false);\n        }\n        if (!didCancel) {\n          api\n            .getProfile({ optional: true })\n            .then((profileResponse: ProfileInfo | undefined) => {\n              if (!didCancel) {\n                if (sessionState === SessionState.SignedIn) {\n                  setSignedIn(true);\n                }\n                if (profileResponse) {\n                  setProfile(profileResponse);\n                }\n              }\n            });\n        }\n      });\n\n    return () => {\n      didCancel = true;\n      subscription.unsubscribe();\n    };\n  }, [api]);\n\n  return (\n    <ListItem>\n      <ListItemIcon>\n        <Icon />\n      </ListItemIcon>\n      <ListItemText\n        primary={title}\n        secondary={\n          <Tooltip placement=\"top\" arrow title={description}>\n            <Grid container spacing={6}>\n              <Grid item>\n                <ProviderSettingsAvatar size={48} picture={profile.picture} />\n              </Grid>\n              <Grid item xs={12} sm container>\n                <Grid item xs container direction=\"column\" spacing={2}>\n                  <Grid item xs>\n                    {profile.displayName && (\n                      <Typography\n                        variant=\"subtitle1\"\n                        color=\"textPrimary\"\n                        gutterBottom\n                      >\n                        {profile.displayName}\n                      </Typography>\n                    )}\n                    {profile.email && (\n                      <Typography variant=\"body2\" color=\"textSecondary\">\n                        {profile.email}\n                      </Typography>\n                    )}\n                    <Typography variant=\"body2\" color=\"textSecondary\">\n                      {description}\n                    </Typography>\n                  </Grid>\n                </Grid>\n              </Grid>\n            </Grid>\n          </Tooltip>\n        }\n        secondaryTypographyProps={{ noWrap: true, style: { width: '80%' } }}\n      />\n      <ListItemSecondaryAction>\n        <Tooltip\n          placement=\"top\"\n          arrow\n          title={\n            signedIn\n              ? t('providerSettingsItem.title.signOut', { title })\n              : t('providerSettingsItem.title.signIn', { title })\n          }\n        >\n          <Button\n            variant=\"outlined\"\n            color=\"primary\"\n            onClick={() => {\n              const action = signedIn ? api.signOut() : api.signIn();\n              action.catch(error => errorApi.post(error));\n            }}\n          >\n            {signedIn\n              ? t('providerSettingsItem.buttonTitle.signOut')\n              : t('providerSettingsItem.buttonTitle.signIn')}\n          </Button>\n        </Tooltip>\n      </ListItemSecondaryAction>\n    </ListItem>\n  );\n};\n"],"names":[],"mappings":"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"}