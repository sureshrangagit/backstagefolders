{"version":3,"file":"RenderSchema.esm.js","sources":["../../../src/components/RenderSchema/RenderSchema.tsx"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { MarkdownContent } from '@backstage/core-components';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\nimport Box from '@material-ui/core/Box';\nimport Chip from '@material-ui/core/Chip';\nimport Collapse from '@material-ui/core/Collapse';\nimport IconButton from '@material-ui/core/IconButton';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport Paper from '@material-ui/core/Paper';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableContainer from '@material-ui/core/TableContainer';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { ClassNameMap } from '@material-ui/core/styles/withStyles';\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport WrapText from '@material-ui/icons/WrapText';\nimport classNames from 'classnames';\nimport {\n  JSONSchema7,\n  JSONSchema7Definition,\n  JSONSchema7Type,\n} from 'json-schema';\nimport { FC, JSX, cloneElement, Fragment, ReactElement } from 'react';\nimport { scaffolderTranslationRef } from '../../translation';\nimport { SchemaRenderContext, SchemaRenderStrategy } from './types';\nimport { TranslationMessages } from '../TemplatingExtensionsPage/types';\n\nconst compositeSchemaProperties = ['allOf', 'anyOf', 'not', 'oneOf'] as const;\n\ntype subSchemasType = {\n  [K in (typeof compositeSchemaProperties)[number]]?: JSONSchema7Definition[];\n};\n\nconst getTypes = (schema: JSONSchema7) => {\n  if (!schema.type) {\n    if (\n      Object.getOwnPropertyNames(schema).some(p =>\n        compositeSchemaProperties.includes(p as any),\n      )\n    ) {\n      return undefined;\n    }\n    return ['unknown'];\n  }\n  if (schema.type !== 'array') {\n    return [schema.type].flat();\n  }\n  return [\n    `${schema.type}(${\n      (schema.items as JSONSchema7 | undefined)?.type ?? 'unknown'\n    })`,\n  ];\n};\n\nconst getSubschemas = (schema: JSONSchema7Definition): subSchemasType => {\n  if (typeof schema === 'boolean') {\n    return {};\n  }\n  const base: Omit<JSONSchema7, keyof subSchemasType> = {};\n\n  const subschemas: subSchemasType = {};\n\n  for (const [key, value] of Object.entries(schema) as [\n    keyof JSONSchema7,\n    any,\n  ][]) {\n    if (compositeSchemaProperties.includes(key as keyof subSchemasType)) {\n      let v;\n      if (Array.isArray(value)) {\n        if (!value.length) {\n          continue;\n        }\n        v = value;\n      } else if (value) {\n        v = [value];\n      } else {\n        continue;\n      }\n      subschemas[key as keyof subSchemasType] = v as any;\n    } else {\n      base[key as Exclude<keyof JSONSchema7, keyof subSchemasType>] = value;\n    }\n  }\n  return Object.fromEntries(\n    Object.entries(subschemas).map(([key, sub]) => {\n      const mergedSubschema = sub.map(alt => {\n        if (typeof alt !== 'boolean' && alt.required) {\n          const properties: JSONSchema7['properties'] = {};\n          if (schema.properties) {\n            for (const k of alt.required) {\n              if (k in schema.properties) {\n                properties[k] = schema.properties[k];\n              }\n            }\n          }\n          Object.assign(properties, alt.properties);\n          return {\n            ...base,\n            ...alt,\n            properties,\n          };\n        }\n        return alt;\n      });\n      return [key, mergedSubschema];\n    }),\n  );\n};\n\nconst useColumnStyles = makeStyles({\n  description: {\n    width: '40%',\n    whiteSpace: 'normal',\n    wordWrap: 'break-word',\n    '&.MuiTableCell-root': {\n      whiteSpace: 'normal',\n    },\n  },\n  standard: {\n    whiteSpace: 'normal',\n  },\n});\n\ntype SchemaRenderElement = {\n  schema: JSONSchema7Definition;\n  key?: string;\n  required?: boolean;\n};\n\ntype RenderColumn = (\n  element: SchemaRenderElement,\n  context: SchemaRenderContext,\n) => JSX.Element;\n\ntype Column = {\n  key: string;\n  title: (t: TranslationMessages<typeof scaffolderTranslationRef>) => string;\n  render: RenderColumn;\n  className?: keyof ReturnType<typeof useColumnStyles>;\n};\n\nconst generateId = (\n  element: SchemaRenderElement,\n  context: SchemaRenderContext,\n) => {\n  return element.key ? `${context.parentId}.${element.key}` : context.parentId;\n};\n\nconst nameColumn = {\n  key: 'name',\n  title: t => t('renderSchema.tableCell.name'),\n  render: (element: SchemaRenderElement, context: SchemaRenderContext) => {\n    return (\n      <div\n        className={classNames(context.classes.code, {\n          [context.classes.codeRequired]: element.required,\n        })}\n      >\n        {element.key}\n      </div>\n    );\n  },\n} as Column;\n\nconst titleColumn = {\n  key: 'title',\n  title: t => t('renderSchema.tableCell.title'),\n  render: (element: SchemaRenderElement) => (\n    <MarkdownContent content={(element.schema as JSONSchema7).title ?? ''} />\n  ),\n} as Column;\n\nconst descriptionColumn = {\n  key: 'description',\n  title: t => t('renderSchema.tableCell.description'),\n  render: (element: SchemaRenderElement) => (\n    <MarkdownContent\n      content={(element.schema as JSONSchema7).description ?? ''}\n    />\n  ),\n  className: 'description',\n} as Column;\n\nconst enumFrom = (schema: JSONSchema7) => {\n  if (schema.type === 'array') {\n    if (schema.items && typeof schema.items !== 'boolean') {\n      if (Array.isArray(schema.items)) {\n        const itemsWithEnum = schema.items\n          .filter(e => typeof e === 'object' && 'enum' in e)\n          .map(e => e as JSONSchema7);\n        if (itemsWithEnum.length) {\n          return itemsWithEnum[0].enum;\n        }\n      } else {\n        return schema.items?.enum;\n      }\n    }\n    return undefined;\n  }\n  return schema.enum;\n};\n\nconst inspectSchema = (\n  schema: JSONSchema7Definition,\n): {\n  canSubschema: boolean;\n  hasEnum: boolean;\n} => {\n  if (typeof schema === 'boolean') {\n    return { canSubschema: false, hasEnum: false };\n  }\n  return {\n    canSubschema:\n      Object.getOwnPropertyNames(schema).some(p =>\n        compositeSchemaProperties.includes(p as any),\n      ) || getTypes(schema)!.some(t => t.includes('object')),\n    hasEnum: !!enumFrom(schema),\n  };\n};\n\nconst typeColumn = {\n  key: 'type',\n  title: t => t('renderSchema.tableCell.type'),\n  render: (element: SchemaRenderElement, context: SchemaRenderContext) => {\n    if (typeof element.schema === 'boolean') {\n      return <Typography>{element.schema ? 'any' : 'none'}</Typography>;\n    }\n    const types = getTypes(element.schema);\n    const [isExpanded, setIsExpanded] = context.expanded;\n    const id = generateId(element, context);\n    const info = inspectSchema(element.schema);\n    return (\n      <>\n        {types?.map((type, index) =>\n          info.canSubschema || (info.hasEnum && index === 0) ? (\n            <Chip\n              data-testid={`expand_${id}`}\n              label={type}\n              key={type}\n              icon={isExpanded[id] ? <ExpandLessIcon /> : <ExpandMoreIcon />}\n              variant=\"outlined\"\n              onClick={() =>\n                setIsExpanded(prevState => {\n                  return {\n                    ...prevState,\n                    [id]: !!!prevState[id],\n                  };\n                })\n              }\n            />\n          ) : (\n            <Chip label={type} key={type} variant=\"outlined\" />\n          ),\n        )}\n      </>\n    );\n  },\n} as Column;\n\nexport const RenderEnum: FC<{\n  e: JSONSchema7Type[];\n  classes: ClassNameMap;\n  [key: string]: any;\n}> = ({\n  e,\n  classes,\n  ...props\n}: {\n  e: JSONSchema7Type[];\n  classes: ClassNameMap;\n}) => {\n  return (\n    <List {...props}>\n      {e.map((v, i) => {\n        let inner: JSX.Element = (\n          <Typography\n            data-testid={`enum_el${i}`}\n            className={classNames(classes.code)}\n          >\n            {JSON.stringify(v)}\n          </Typography>\n        );\n        if (v !== null && ['object', 'array'].includes(typeof v)) {\n          inner = (\n            <>\n              {inner}\n              <Tooltip\n                title={\n                  <Typography\n                    data-testid={`pretty_${i}`}\n                    className={classNames(classes.code)}\n                    style={{ whiteSpace: 'pre-wrap' }}\n                  >\n                    {JSON.stringify(v, undefined, 2)}\n                  </Typography>\n                }\n              >\n                <IconButton data-testid={`wrap-text_${i}`}>\n                  <WrapText />\n                </IconButton>\n              </Tooltip>\n            </>\n          );\n        }\n        return <ListItem key={i}>{inner}</ListItem>;\n      })}\n    </List>\n  );\n};\n\nconst useTableStyles = makeStyles({\n  schema: {\n    width: '100%',\n    overflowX: 'hidden',\n    '& table': {\n      width: '100%',\n      tableLayout: 'fixed',\n    },\n  },\n});\n\nexport const RenderSchema = ({\n  strategy,\n  context,\n  schema,\n}: {\n  strategy: SchemaRenderStrategy;\n  context: SchemaRenderContext;\n  schema?: JSONSchema7Definition;\n}) => {\n  const { t } = useTranslationRef(scaffolderTranslationRef);\n  const tableStyles = useTableStyles();\n  const columnStyles = useColumnStyles();\n  const result = (() => {\n    if (typeof schema === 'object') {\n      const subschemas = getSubschemas(schema);\n      let columns: Column[] | undefined;\n      let elements: SchemaRenderElement[] | undefined;\n      if (strategy === 'root') {\n        elements = [{ schema }];\n        columns = [typeColumn];\n        if (schema.description) {\n          columns.unshift(descriptionColumn);\n        }\n        if (schema.title) {\n          columns.unshift(titleColumn);\n        }\n      } else if (schema.properties) {\n        columns = [nameColumn, titleColumn, descriptionColumn, typeColumn];\n        elements = Object.entries(schema.properties!).map(([key, v]) => ({\n          schema: v,\n          key,\n          required: schema.required?.includes(key),\n        }));\n      } else if (!Object.keys(subschemas).length) {\n        return undefined;\n      }\n      const [isExpanded] = context.expanded;\n\n      return (\n        <>\n          {columns && elements && (\n            <TableContainer component={Paper} className={tableStyles.schema}>\n              <Table\n                data-testid={`${strategy}_${context.parentId}`}\n                size=\"small\"\n              >\n                <TableHead>\n                  <TableRow>\n                    {columns.map((col, index) => (\n                      <TableCell\n                        key={index}\n                        className={columnStyles[col.className ?? 'standard']}\n                      >\n                        {col.title(t)}\n                      </TableCell>\n                    ))}\n                  </TableRow>\n                </TableHead>\n                <TableBody>\n                  {elements.map(el => {\n                    const id = generateId(el, context);\n                    const info = inspectSchema(el.schema);\n                    const rows = [\n                      <TableRow data-testid={`${strategy}-row_${id}`}>\n                        {columns!.map(col => (\n                          <TableCell\n                            key={col.key}\n                            className={\n                              columnStyles[col.className ?? 'standard']\n                            }\n                          >\n                            {col.render(el, context)}\n                          </TableCell>\n                        ))}\n                      </TableRow>,\n                    ];\n                    if (\n                      typeof el.schema !== 'boolean' &&\n                      (info.canSubschema || info.hasEnum)\n                    ) {\n                      let details: ReactElement = (\n                        <Box data-testid={`expansion_${id}`} sx={{ margin: 1 }}>\n                          {info.canSubschema && (\n                            <RenderSchema\n                              strategy=\"properties\"\n                              context={{\n                                ...context,\n                                parentId: id,\n                                parent: context,\n                              }}\n                              schema={\n                                el.schema.type === 'array'\n                                  ? (el.schema.items as JSONSchema7 | undefined)\n                                  : el.schema\n                              }\n                            />\n                          )}\n                          {info.hasEnum && (\n                            <>\n                              {cloneElement(\n                                context.headings[0],\n                                {},\n                                'Valid values:',\n                              )}\n                              <RenderEnum\n                                data-testid={`enum_${id}`}\n                                e={enumFrom(el.schema)!}\n                                classes={context.classes}\n                              />\n                            </>\n                          )}\n                        </Box>\n                      );\n                      if (getTypes(el.schema)) {\n                        details = (\n                          <Collapse\n                            in={isExpanded[id]}\n                            timeout=\"auto\"\n                            unmountOnExit\n                          >\n                            {details}\n                          </Collapse>\n                        );\n                      }\n                      rows.push(\n                        <TableRow>\n                          <TableCell\n                            style={{ paddingBottom: 0, paddingTop: 0 }}\n                            colSpan={columns!.length}\n                          >\n                            {details}\n                          </TableCell>\n                        </TableRow>,\n                      );\n                    }\n                    return <Fragment key={id}>{rows}</Fragment>;\n                  })}\n                </TableBody>\n              </Table>\n            </TableContainer>\n          )}\n          {(Object.keys(subschemas) as Array<keyof subSchemasType>).map(sk => (\n            <Fragment key={sk}>\n              {cloneElement(context.headings[0], {}, sk)}\n              {subschemas[sk]!.map((sub, index) => (\n                <RenderSchema\n                  key={index}\n                  strategy={\n                    typeof sub !== 'boolean' && 'properties' in sub\n                      ? strategy\n                      : 'root'\n                  }\n                  {...{\n                    context: {\n                      ...context,\n                      parentId: `${context.parentId}_${sk}${index}`,\n                    },\n                    schema: sub,\n                  }}\n                />\n              ))}\n            </Fragment>\n          ))}\n        </>\n      );\n    }\n    return undefined;\n  })();\n  return result ?? <Typography>No schema defined</Typography>;\n};\n"],"names":["Fragment"],"mappings":"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"}