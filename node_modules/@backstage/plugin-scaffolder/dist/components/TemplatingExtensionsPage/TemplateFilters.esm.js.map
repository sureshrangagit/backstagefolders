{"version":3,"file":"TemplateFilters.esm.js","sources":["../../../src/components/TemplatingExtensionsPage/TemplateFilters.tsx"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Link, MarkdownContent } from '@backstage/core-components';\nimport {\n  ListTemplatingExtensionsResponse,\n  TemplateFilter,\n} from '@backstage/plugin-scaffolder-react';\nimport Accordion from '@material-ui/core/Accordion';\nimport AccordionDetails from '@material-ui/core/AccordionDetails';\nimport AccordionSummary from '@material-ui/core/AccordionSummary';\nimport Box from '@material-ui/core/Box';\nimport { ClassNameMap } from '@material-ui/core/styles/withStyles';\nimport Typography from '@material-ui/core/Typography';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport classNames from 'classnames';\nimport { cloneElement, Fragment, ReactElement, useState } from 'react';\nimport { scaffolderTranslationRef } from '../../translation';\nimport { Expanded, RenderSchema, SchemaRenderContext } from '../RenderSchema';\nimport { ScaffolderUsageExamplesTable } from '../ScaffolderUsageExamplesTable';\nimport { inspectFunctionArgSchema } from './functionArgs';\nimport { Extension, renderFragment } from './navigation';\nimport { StyleClasses, TranslationMessages } from './types';\n\nconst FilterDetailContent = ({\n  t,\n  classes,\n  name,\n  filter,\n}: {\n  t: TranslationMessages<typeof scaffolderTranslationRef>;\n  classes: ClassNameMap;\n  name: string;\n  filter: TemplateFilter;\n}) => {\n  const expanded = useState<Expanded>({});\n  if (!Object.keys(filter).length) {\n    return (\n      <Typography style={{ fontStyle: 'italic' }}>\n        {t('templatingExtensions.content.filters.metadataAbsent')}\n      </Typography>\n    );\n  }\n  const schema = filter.schema;\n  const partialSchemaRenderContext: Omit<SchemaRenderContext, 'parentId'> = {\n    classes,\n    expanded,\n    headings: [<Typography variant=\"h6\" component=\"h4\" />],\n  };\n  return (\n    <Fragment key={`${name}.detail`}>\n      {filter.description && <MarkdownContent content={filter.description} />}\n      <Box pb={2}>\n        <Typography variant=\"h5\" component=\"h3\">\n          {t('templatingExtensions.content.filters.schema.input')}\n        </Typography>\n        <RenderSchema\n          strategy=\"root\"\n          context={{\n            parentId: `${name}.input`,\n            ...partialSchemaRenderContext,\n          }}\n          schema={schema?.input ?? {}}\n        />\n      </Box>\n      {schema?.arguments?.length && (\n        <Box key={`${name}.args`} pb={2}>\n          <Typography variant=\"h5\" component=\"h3\">\n            {t('templatingExtensions.content.filters.schema.arguments')}\n          </Typography>\n          {schema.arguments.map((arg, i) => {\n            const [argSchema, required] = inspectFunctionArgSchema(arg);\n\n            return (\n              <Fragment key={i}>\n                <div\n                  className={classNames({ [classes.argRequired]: required })}\n                >\n                  <Typography variant=\"h6\" component=\"h4\">\n                    {`[${i}]`}\n                  </Typography>\n                </div>\n                <RenderSchema\n                  strategy=\"root\"\n                  context={{\n                    parentId: `${name}.arg${i}`,\n                    ...partialSchemaRenderContext,\n                    headings: [<Typography variant=\"h6\" component=\"h5\" />],\n                  }}\n                  schema={argSchema}\n                />\n              </Fragment>\n            );\n          })}\n        </Box>\n      )}\n      <Box pb={2}>\n        <Typography variant=\"h5\" component=\"h3\">\n          {t('templatingExtensions.content.filters.schema.output')}\n        </Typography>\n        <RenderSchema\n          strategy=\"root\"\n          context={{\n            parentId: `${name}.output`,\n            ...partialSchemaRenderContext,\n          }}\n          schema={schema?.output ?? {}}\n        />\n      </Box>\n      {filter.examples && (\n        <Accordion>\n          <AccordionSummary expandIcon={<ExpandMoreIcon />}>\n            <Typography variant=\"h5\" component=\"h3\">\n              {t('templatingExtensions.content.filters.examples')}\n            </Typography>\n          </AccordionSummary>\n          <AccordionDetails>\n            <Box pb={2}>\n              <ScaffolderUsageExamplesTable examples={filter.examples} />\n            </Box>\n          </AccordionDetails>\n        </Accordion>\n      )}\n    </Fragment>\n  );\n};\n\nexport const TemplateFilters = ({\n  t,\n  classes,\n  filters,\n  baseLink,\n  selectedItem,\n}: {\n  t: TranslationMessages<typeof scaffolderTranslationRef>;\n  classes: StyleClasses;\n  filters: ListTemplatingExtensionsResponse['filters'];\n  baseLink: ReactElement<Parameters<typeof Link>[0]>;\n  selectedItem: Extension | null;\n}) => {\n  if (selectedItem && selectedItem.kind !== 'filter') {\n    return <></>;\n  }\n  if (!Object.keys(filters).length) {\n    return (\n      <div data-testid=\"no-filters\">\n        {t('templatingExtensions.content.filters.notAvailable')}\n      </div>\n    );\n  }\n  return (\n    <div data-testid=\"filters\">\n      {Object.entries(\n        selectedItem\n          ? { [selectedItem.name]: filters[selectedItem.name] }\n          : filters,\n      ).map(([name, filter]) => {\n        const fragment = renderFragment({ kind: 'filter', name });\n        return (\n          <Box pb={4} key={name} data-testid={name}>\n            <Typography\n              id={fragment}\n              variant=\"h4\"\n              component=\"h2\"\n              className={classes.code}\n            >\n              {name}\n            </Typography>\n            {cloneElement(baseLink, {\n              to: `${baseLink.props.to}#${fragment}`,\n            })}\n            <FilterDetailContent {...{ t, classes, name, filter }} />\n          </Box>\n        );\n      })}\n    </div>\n  );\n};\n"],"names":["Fragment"],"mappings":"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"}