{"version":3,"file":"entityContents.esm.js","sources":["../../src/alpha/entityContents.tsx"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { lazy as reactLazy } from 'react';\nimport {\n  coreExtensionData,\n  createExtensionInput,\n  ExtensionBoundary,\n} from '@backstage/frontend-plugin-api';\nimport {\n  EntityCardBlueprint,\n  EntityContentBlueprint,\n  EntityContentLayoutBlueprint,\n  EntityContentLayoutProps,\n} from '@backstage/plugin-catalog-react/alpha';\nimport { buildFilterFn } from './filter/FilterWrapper';\nimport { useEntity } from '@backstage/plugin-catalog-react';\n\nexport const catalogOverviewEntityContent =\n  EntityContentBlueprint.makeWithOverrides({\n    name: 'overview',\n    inputs: {\n      layouts: createExtensionInput([\n        EntityContentLayoutBlueprint.dataRefs.filterFunction.optional(),\n        EntityContentLayoutBlueprint.dataRefs.filterExpression.optional(),\n        EntityContentLayoutBlueprint.dataRefs.component,\n      ]),\n      cards: createExtensionInput([\n        coreExtensionData.reactElement,\n        EntityContentBlueprint.dataRefs.filterFunction.optional(),\n        EntityContentBlueprint.dataRefs.filterExpression.optional(),\n        EntityCardBlueprint.dataRefs.type.optional(),\n      ]),\n    },\n    factory: (originalFactory, { node, inputs }) => {\n      return originalFactory({\n        defaultPath: '/',\n        defaultTitle: 'Overview',\n        defaultGroup: 'overview',\n        loader: async () => {\n          const LazyDefaultLayoutComponent = reactLazy(() =>\n            import('./DefaultEntityContentLayout').then(m => ({\n              default: m.DefaultEntityContentLayout,\n            })),\n          );\n\n          const DefaultLayoutComponent = (props: EntityContentLayoutProps) => {\n            return (\n              <ExtensionBoundary node={node}>\n                <LazyDefaultLayoutComponent {...props} />\n              </ExtensionBoundary>\n            );\n          };\n\n          const layouts = [\n            ...inputs.layouts.map(layout => ({\n              filter: buildFilterFn(\n                layout.get(\n                  EntityContentLayoutBlueprint.dataRefs.filterFunction,\n                ),\n                layout.get(\n                  EntityContentLayoutBlueprint.dataRefs.filterExpression,\n                ),\n              ),\n              Component: layout.get(\n                EntityContentLayoutBlueprint.dataRefs.component,\n              ),\n            })),\n            {\n              filter: buildFilterFn(),\n              Component: DefaultLayoutComponent,\n            },\n          ];\n\n          const cards = inputs.cards.map(card => ({\n            element: card.get(coreExtensionData.reactElement),\n            type: card.get(EntityCardBlueprint.dataRefs.type),\n            filter: buildFilterFn(\n              card.get(EntityContentBlueprint.dataRefs.filterFunction),\n              card.get(EntityContentBlueprint.dataRefs.filterExpression),\n            ),\n          }));\n\n          const Component = () => {\n            const { entity } = useEntity();\n\n            // Use the first layout that matches the entity filter\n            const layout = layouts.find(l => l.filter(entity));\n            if (!layout) {\n              throw new Error('No layout found for entity'); // Shouldn't be able to happen\n            }\n\n            return (\n              <layout.Component\n                cards={cards.filter(card => card.filter(entity))}\n              />\n            );\n          };\n\n          return <Component />;\n        },\n      });\n    },\n  });\n\nexport default [catalogOverviewEntityContent];\n"],"names":["reactLazy"],"mappings":"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"}