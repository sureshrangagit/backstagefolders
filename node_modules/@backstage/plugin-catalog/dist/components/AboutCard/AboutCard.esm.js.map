{"version":3,"file":"AboutCard.esm.js","sources":["../../../src/components/AboutCard/AboutCard.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback } from 'react';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport CardHeader from '@material-ui/core/CardHeader';\nimport Divider from '@material-ui/core/Divider';\nimport IconButton from '@material-ui/core/IconButton';\nimport CachedIcon from '@material-ui/icons/Cached';\nimport EditIcon from '@material-ui/icons/Edit';\nimport DocsIcon from '@material-ui/icons/Description';\nimport CreateComponentIcon from '@material-ui/icons/AddCircleOutline';\n\nimport {\n  AppIcon,\n  HeaderIconLinkRow,\n  IconLinkVerticalProps,\n  InfoCardVariants,\n  Link,\n} from '@backstage/core-components';\nimport {\n  alertApiRef,\n  errorApiRef,\n  useApp,\n  useApi,\n  useRouteRef,\n} from '@backstage/core-plugin-api';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\n\nimport {\n  ScmIntegrationIcon,\n  scmIntegrationsApiRef,\n} from '@backstage/integration-react';\n\nimport {\n  DEFAULT_NAMESPACE,\n  ANNOTATION_EDIT_URL,\n  ANNOTATION_LOCATION,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport {\n  catalogApiRef,\n  getEntitySourceLocation,\n  useEntity,\n} from '@backstage/plugin-catalog-react';\nimport { useEntityPermission } from '@backstage/plugin-catalog-react/alpha';\nimport { catalogEntityRefreshPermission } from '@backstage/plugin-catalog-common/alpha';\n\nimport {\n  TECHDOCS_ANNOTATION,\n  TECHDOCS_EXTERNAL_ANNOTATION,\n} from '@backstage/plugin-techdocs-common';\nimport { buildTechDocsURL } from '@backstage/plugin-techdocs-react';\n\nimport { isTemplateEntityV1beta3 } from '@backstage/plugin-scaffolder-common';\nimport { taskCreatePermission } from '@backstage/plugin-scaffolder-common/alpha';\n\nimport { usePermission } from '@backstage/plugin-permission-react';\n\nimport { createFromTemplateRouteRef, viewTechDocRouteRef } from '../../routes';\nimport { catalogTranslationRef } from '../../alpha/translation';\nimport { useSourceTemplateCompoundEntityRef } from './hooks';\nimport { AboutContent } from './AboutContent';\n\nexport function useCatalogSourceIconLinkProps() {\n  const { entity } = useEntity();\n  const scmIntegrationsApi = useApi(scmIntegrationsApiRef);\n  const { t } = useTranslationRef(catalogTranslationRef);\n  const entitySourceLocation = getEntitySourceLocation(\n    entity,\n    scmIntegrationsApi,\n  );\n  return {\n    label: t('aboutCard.viewSource'),\n    disabled: !entitySourceLocation,\n    icon: <ScmIntegrationIcon type={entitySourceLocation?.integrationType} />,\n    href: entitySourceLocation?.locationTargetUrl,\n  };\n}\n\n// TODO: This hook is duplicated from the TechDocs plugin for backwards compatibility\n// Remove it when the the legacy frontend system support is dropped.\nfunction useTechdocsReaderIconLinkProps(): IconLinkVerticalProps {\n  const { entity } = useEntity();\n  const viewTechdocLink = useRouteRef(viewTechDocRouteRef);\n  const { t } = useTranslationRef(catalogTranslationRef);\n\n  return {\n    label: t('aboutCard.viewTechdocs'),\n    disabled:\n      !(\n        entity.metadata.annotations?.[TECHDOCS_ANNOTATION] ||\n        entity.metadata.annotations?.[TECHDOCS_EXTERNAL_ANNOTATION]\n      ) || !viewTechdocLink,\n    icon: <DocsIcon />,\n    href: buildTechDocsURL(entity, viewTechdocLink),\n  };\n}\n\n// TODO: This hook is duplicated from the Scaffolder plugin for backwards compatibility\n// Remove it when the the legacy frontend system support is dropped.\nfunction useScaffolderTemplateIconLinkProps(): IconLinkVerticalProps {\n  const app = useApp();\n  const { entity } = useEntity();\n  const templateRoute = useRouteRef(createFromTemplateRouteRef);\n  const { t } = useTranslationRef(catalogTranslationRef);\n  const Icon = app.getSystemIcon('scaffolder') ?? CreateComponentIcon;\n  const { allowed: canCreateTemplateTask } = usePermission({\n    permission: taskCreatePermission,\n  });\n\n  return {\n    label: t('aboutCard.launchTemplate'),\n    icon: <Icon />,\n    disabled: !templateRoute || !canCreateTemplateTask,\n    href:\n      templateRoute &&\n      templateRoute({\n        templateName: entity.metadata.name,\n        namespace: entity.metadata.namespace || DEFAULT_NAMESPACE,\n      }),\n  };\n}\n\nfunction DefaultAboutCardSubheader() {\n  const { entity } = useEntity();\n  const catalogSourceIconLink = useCatalogSourceIconLinkProps();\n  const techdocsreaderIconLink = useTechdocsReaderIconLinkProps();\n  const scaffolderTemplateIconLink = useScaffolderTemplateIconLinkProps();\n\n  const links = [catalogSourceIconLink, techdocsreaderIconLink];\n  if (isTemplateEntityV1beta3(entity)) {\n    links.push(scaffolderTemplateIconLink);\n  }\n\n  return <HeaderIconLinkRow links={links} />;\n}\n\nconst useStyles = makeStyles({\n  gridItemCard: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: 'calc(100% - 10px)', // for pages without content header\n    marginBottom: '10px',\n  },\n  fullHeightCard: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%',\n  },\n  gridItemCardContent: {\n    flex: 1,\n  },\n  fullHeightCardContent: {\n    flex: 1,\n  },\n});\n\n/**\n * Props for {@link EntityAboutCard}.\n *\n * @public\n */\nexport type AboutCardProps = {\n  variant?: InfoCardVariants;\n};\n\nexport interface InternalAboutCardProps extends AboutCardProps {\n  subheader?: JSX.Element;\n}\n\nexport function InternalAboutCard(props: InternalAboutCardProps) {\n  const { variant, subheader } = props;\n  const classes = useStyles();\n  const { entity } = useEntity();\n  const catalogApi = useApi(catalogApiRef);\n  const alertApi = useApi(alertApiRef);\n  const errorApi = useApi(errorApiRef);\n  const templateRoute = useRouteRef(createFromTemplateRouteRef);\n  const sourceTemplateRef = useSourceTemplateCompoundEntityRef(entity);\n  const { allowed: canRefresh } = useEntityPermission(\n    catalogEntityRefreshPermission,\n  );\n  const { t } = useTranslationRef(catalogTranslationRef);\n\n  const entityMetadataEditUrl =\n    entity.metadata.annotations?.[ANNOTATION_EDIT_URL];\n\n  let cardClass = '';\n  if (variant === 'gridItem') {\n    cardClass = classes.gridItemCard;\n  } else if (variant === 'fullHeight') {\n    cardClass = classes.fullHeightCard;\n  }\n\n  let cardContentClass = '';\n  if (variant === 'gridItem') {\n    cardContentClass = classes.gridItemCardContent;\n  } else if (variant === 'fullHeight') {\n    cardContentClass = classes.fullHeightCardContent;\n  }\n\n  const entityLocation = entity.metadata.annotations?.[ANNOTATION_LOCATION];\n  // Limiting the ability to manually refresh to the less expensive locations\n  const allowRefresh =\n    entityLocation?.startsWith('url:') || entityLocation?.startsWith('file:');\n  const refreshEntity = useCallback(async () => {\n    try {\n      await catalogApi.refreshEntity(stringifyEntityRef(entity));\n      alertApi.post({\n        message: t('aboutCard.refreshScheduledMessage'),\n        severity: 'info',\n        display: 'transient',\n      });\n    } catch (e) {\n      errorApi.post(e);\n    }\n  }, [catalogApi, entity, alertApi, t, errorApi]);\n\n  return (\n    <Card className={cardClass}>\n      <CardHeader\n        title={t('aboutCard.title')}\n        action={\n          <>\n            {allowRefresh && canRefresh && (\n              <IconButton\n                aria-label=\"Refresh\"\n                title={t('aboutCard.refreshButtonTitle')}\n                onClick={refreshEntity}\n              >\n                <CachedIcon />\n              </IconButton>\n            )}\n            <IconButton\n              component={Link}\n              aria-label=\"Edit\"\n              disabled={!entityMetadataEditUrl}\n              title={t('aboutCard.editButtonTitle')}\n              to={entityMetadataEditUrl ?? '#'}\n            >\n              <EditIcon />\n            </IconButton>\n            {sourceTemplateRef && templateRoute && (\n              <IconButton\n                component={Link}\n                title={t('aboutCard.createSimilarButtonTitle')}\n                to={templateRoute({\n                  namespace: sourceTemplateRef.namespace,\n                  templateName: sourceTemplateRef.name,\n                })}\n              >\n                <AppIcon id=\"scaffolder\" />\n              </IconButton>\n            )}\n          </>\n        }\n        subheader={subheader ?? <DefaultAboutCardSubheader />}\n      />\n      <Divider />\n      <CardContent className={cardContentClass}>\n        <AboutContent entity={entity} />\n      </CardContent>\n    </Card>\n  );\n}\n\n/**\n * Exported publicly via the EntityAboutCard\n *\n * NOTE: We generally do not accept pull requests to extend this class with more\n * props and customizability. If you need to tweak it, consider making a bespoke\n * card in your own repository instead, that is perfect for your own needs.\n */\nexport function AboutCard(props: AboutCardProps) {\n  return <InternalAboutCard {...props} />;\n}\n"],"names":[],"mappings":"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"}