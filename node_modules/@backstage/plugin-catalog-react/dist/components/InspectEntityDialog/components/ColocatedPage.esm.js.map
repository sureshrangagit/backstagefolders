{"version":3,"file":"ColocatedPage.esm.js","sources":["../../../../src/components/InspectEntityDialog/components/ColocatedPage.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  ANNOTATION_LOCATION,\n  ANNOTATION_ORIGIN_LOCATION,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { Progress, ResponseErrorPanel } from '@backstage/core-components';\nimport { useApi } from '@backstage/core-plugin-api';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Alert from '@material-ui/lab/Alert';\nimport useAsync from 'react-use/esm/useAsync';\nimport { catalogApiRef } from '../../../api';\nimport { EntityRefLink } from '../../EntityRefLink';\nimport { KeyValueListItem, ListItemText } from './common';\nimport { catalogReactTranslationRef } from '../../../translation';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\n\nconst useStyles = makeStyles({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n  },\n});\n\nfunction useColocated(entity: Entity): {\n  loading: boolean;\n  error?: Error;\n  location?: string;\n  originLocation?: string;\n  colocatedEntities?: Entity[];\n} {\n  const catalogApi = useApi(catalogApiRef);\n  const currentEntityRef = stringifyEntityRef(entity);\n  const location = entity.metadata.annotations?.[ANNOTATION_LOCATION];\n  const origin = entity.metadata.annotations?.[ANNOTATION_ORIGIN_LOCATION];\n\n  const { loading, error, value } = useAsync(async () => {\n    if (!location && !origin) {\n      return [];\n    }\n    const response = await catalogApi.getEntities({\n      filter: [\n        ...(location\n          ? [{ [`metadata.annotations.${ANNOTATION_LOCATION}`]: location }]\n          : []),\n        ...(origin\n          ? [{ [`metadata.annotations.${ANNOTATION_ORIGIN_LOCATION}`]: origin }]\n          : []),\n      ],\n    });\n    return response.items;\n  }, [location, origin]);\n\n  return {\n    loading,\n    error,\n    location,\n    originLocation: origin,\n    colocatedEntities: value?.filter(\n      colocated => stringifyEntityRef(colocated) !== currentEntityRef,\n    ),\n  };\n}\n\nfunction EntityList(props: { entities: Entity[]; header?: [string, string] }) {\n  return (\n    <List dense>\n      {props.header && <KeyValueListItem key=\"header\" entry={props.header} />}\n      {props.entities.map(entity => (\n        <ListItem key={stringifyEntityRef(entity)}>\n          <ListItemText primary={<EntityRefLink entityRef={entity} />} />\n        </ListItem>\n      ))}\n    </List>\n  );\n}\n\nfunction Contents(props: { entity: Entity }) {\n  const { entity } = props;\n  const { t } = useTranslationRef(catalogReactTranslationRef);\n\n  const { loading, error, location, originLocation, colocatedEntities } =\n    useColocated(entity);\n  if (loading) {\n    return <Progress />;\n  } else if (error) {\n    return <ResponseErrorPanel error={error} />;\n  }\n\n  if (!location && !originLocation) {\n    return (\n      <Alert severity=\"warning\">\n        {t('inspectEntityDialog.colocatedPage.alertNoLocation')}\n      </Alert>\n    );\n  } else if (!colocatedEntities?.length) {\n    return (\n      <Alert severity=\"info\">\n        {t('inspectEntityDialog.colocatedPage.alertNoEntity')}\n      </Alert>\n    );\n  }\n\n  if (location === originLocation) {\n    return <EntityList entities={colocatedEntities} />;\n  }\n\n  const atLocation = colocatedEntities.filter(\n    e => e.metadata.annotations?.[ANNOTATION_LOCATION] === location,\n  );\n  const atOrigin = colocatedEntities.filter(\n    e =>\n      e.metadata.annotations?.[ANNOTATION_ORIGIN_LOCATION] === originLocation,\n  );\n\n  return (\n    <>\n      {atLocation.length > 0 && (\n        <EntityList\n          entities={atLocation}\n          header={['At the same location', location!]}\n        />\n      )}\n      {atOrigin.length > 0 && (\n        <EntityList\n          entities={atOrigin}\n          header={['At the same origin', originLocation!]}\n        />\n      )}\n    </>\n  );\n}\n\nexport function ColocatedPage(props: { entity: Entity }) {\n  const classes = useStyles();\n  const { t } = useTranslationRef(catalogReactTranslationRef);\n  return (\n    <>\n      <DialogContentText variant=\"h2\">\n        {t('inspectEntityDialog.colocatedPage.title')}\n      </DialogContentText>\n      <DialogContentText>\n        {t('inspectEntityDialog.colocatedPage.description')}\n      </DialogContentText>\n      <div className={classes.root}>\n        <Contents entity={props.entity} />\n      </div>\n    </>\n  );\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAoCA,MAAM,YAAY,UAAW,CAAA;AAAA,EAC3B,IAAM,EAAA;AAAA,IACJ,OAAS,EAAA,MAAA;AAAA,IACT,aAAe,EAAA;AAAA;AAEnB,CAAC,CAAA;AAED,SAAS,aAAa,MAMpB,EAAA;AACA,EAAM,MAAA,UAAA,GAAa,OAAO,aAAa,CAAA;AACvC,EAAM,MAAA,gBAAA,GAAmB,mBAAmB,MAAM,CAAA;AAClD,EAAA,MAAM,QAAW,GAAA,MAAA,CAAO,QAAS,CAAA,WAAA,GAAc,mBAAmB,CAAA;AAClE,EAAA,MAAM,MAAS,GAAA,MAAA,CAAO,QAAS,CAAA,WAAA,GAAc,0BAA0B,CAAA;AAEvE,EAAA,MAAM,EAAE,OAAS,EAAA,KAAA,EAAO,KAAM,EAAA,GAAI,SAAS,YAAY;AACrD,IAAI,IAAA,CAAC,QAAY,IAAA,CAAC,MAAQ,EAAA;AACxB,MAAA,OAAO,EAAC;AAAA;AAEV,IAAM,MAAA,QAAA,GAAW,MAAM,UAAA,CAAW,WAAY,CAAA;AAAA,MAC5C,MAAQ,EAAA;AAAA,QACN,GAAI,QAAA,GACA,CAAC,EAAE,CAAC,CAAA,qBAAA,EAAwB,mBAAmB,CAAA,CAAE,GAAG,QAAA,EAAU,CAAA,GAC9D,EAAC;AAAA,QACL,GAAI,MAAA,GACA,CAAC,EAAE,CAAC,CAAA,qBAAA,EAAwB,0BAA0B,CAAA,CAAE,GAAG,MAAA,EAAQ,CAAA,GACnE;AAAC;AACP,KACD,CAAA;AACD,IAAA,OAAO,QAAS,CAAA,KAAA;AAAA,GACf,EAAA,CAAC,QAAU,EAAA,MAAM,CAAC,CAAA;AAErB,EAAO,OAAA;AAAA,IACL,OAAA;AAAA,IACA,KAAA;AAAA,IACA,QAAA;AAAA,IACA,cAAgB,EAAA,MAAA;AAAA,IAChB,mBAAmB,KAAO,EAAA,MAAA;AAAA,MACxB,CAAA,SAAA,KAAa,kBAAmB,CAAA,SAAS,CAAM,KAAA;AAAA;AACjD,GACF;AACF;AAEA,SAAS,WAAW,KAA0D,EAAA;AAC5E,EACE,uBAAA,IAAA,CAAC,IAAK,EAAA,EAAA,KAAA,EAAK,IACR,EAAA,QAAA,EAAA;AAAA,IAAA,KAAA,CAAM,0BAAW,GAAA,CAAA,gBAAA,EAAA,EAA8B,KAAO,EAAA,KAAA,CAAM,UAAtB,QAA8B,CAAA;AAAA,IACpE,MAAM,QAAS,CAAA,GAAA,CAAI,4BACjB,GAAA,CAAA,QAAA,EAAA,EACC,8BAAC,YAAa,EAAA,EAAA,OAAA,kBAAU,GAAA,CAAA,aAAA,EAAA,EAAc,WAAW,MAAQ,EAAA,CAAA,EAAI,KADhD,kBAAmB,CAAA,MAAM,CAExC,CACD;AAAA,GACH,EAAA,CAAA;AAEJ;AAEA,SAAS,SAAS,KAA2B,EAAA;AAC3C,EAAM,MAAA,EAAE,QAAW,GAAA,KAAA;AACnB,EAAA,MAAM,EAAE,CAAA,EAAM,GAAA,iBAAA,CAAkB,0BAA0B,CAAA;AAE1D,EAAM,MAAA,EAAE,SAAS,KAAO,EAAA,QAAA,EAAU,gBAAgB,iBAAkB,EAAA,GAClE,aAAa,MAAM,CAAA;AACrB,EAAA,IAAI,OAAS,EAAA;AACX,IAAA,2BAAQ,QAAS,EAAA,EAAA,CAAA;AAAA,aACR,KAAO,EAAA;AAChB,IAAO,uBAAA,GAAA,CAAC,sBAAmB,KAAc,EAAA,CAAA;AAAA;AAG3C,EAAI,IAAA,CAAC,QAAY,IAAA,CAAC,cAAgB,EAAA;AAChC,IAAA,2BACG,KAAM,EAAA,EAAA,QAAA,EAAS,SACb,EAAA,QAAA,EAAA,CAAA,CAAE,mDAAmD,CACxD,EAAA,CAAA;AAAA,GAEJ,MAAA,IAAW,CAAC,iBAAA,EAAmB,MAAQ,EAAA;AACrC,IAAA,2BACG,KAAM,EAAA,EAAA,QAAA,EAAS,MACb,EAAA,QAAA,EAAA,CAAA,CAAE,iDAAiD,CACtD,EAAA,CAAA;AAAA;AAIJ,EAAA,IAAI,aAAa,cAAgB,EAAA;AAC/B,IAAO,uBAAA,GAAA,CAAC,UAAW,EAAA,EAAA,QAAA,EAAU,iBAAmB,EAAA,CAAA;AAAA;AAGlD,EAAA,MAAM,aAAa,iBAAkB,CAAA,MAAA;AAAA,IACnC,CAAK,CAAA,KAAA,CAAA,CAAE,QAAS,CAAA,WAAA,GAAc,mBAAmB,CAAM,KAAA;AAAA,GACzD;AACA,EAAA,MAAM,WAAW,iBAAkB,CAAA,MAAA;AAAA,IACjC,CACE,CAAA,KAAA,CAAA,CAAE,QAAS,CAAA,WAAA,GAAc,0BAA0B,CAAM,KAAA;AAAA,GAC7D;AAEA,EAAA,uBAEK,IAAA,CAAA,QAAA,EAAA,EAAA,QAAA,EAAA;AAAA,IAAA,UAAA,CAAW,SAAS,CACnB,oBAAA,GAAA;AAAA,MAAC,UAAA;AAAA,MAAA;AAAA,QACC,QAAU,EAAA,UAAA;AAAA,QACV,MAAA,EAAQ,CAAC,sBAAA,EAAwB,QAAS;AAAA;AAAA,KAC5C;AAAA,IAED,QAAA,CAAS,SAAS,CACjB,oBAAA,GAAA;AAAA,MAAC,UAAA;AAAA,MAAA;AAAA,QACC,QAAU,EAAA,QAAA;AAAA,QACV,MAAA,EAAQ,CAAC,oBAAA,EAAsB,cAAe;AAAA;AAAA;AAChD,GAEJ,EAAA,CAAA;AAEJ;AAEO,SAAS,cAAc,KAA2B,EAAA;AACvD,EAAA,MAAM,UAAU,SAAU,EAAA;AAC1B,EAAA,MAAM,EAAE,CAAA,EAAM,GAAA,iBAAA,CAAkB,0BAA0B,CAAA;AAC1D,EAAA,uBAEI,IAAA,CAAA,QAAA,EAAA,EAAA,QAAA,EAAA;AAAA,oBAAA,GAAA,CAAC,iBAAkB,EAAA,EAAA,OAAA,EAAQ,IACxB,EAAA,QAAA,EAAA,CAAA,CAAE,yCAAyC,CAC9C,EAAA,CAAA;AAAA,oBACC,GAAA,CAAA,iBAAA,EAAA,EACE,QAAE,EAAA,CAAA,CAAA,+CAA+C,CACpD,EAAA,CAAA;AAAA,oBACA,GAAA,CAAC,KAAI,EAAA,EAAA,SAAA,EAAW,OAAQ,CAAA,IAAA,EACtB,8BAAC,QAAS,EAAA,EAAA,MAAA,EAAQ,KAAM,CAAA,MAAA,EAAQ,CAClC,EAAA;AAAA,GACF,EAAA,CAAA;AAEJ;;;;"}