{"version":3,"file":"UnregisterEntityDialog.esm.js","sources":["../../../src/components/UnregisterEntityDialog/UnregisterEntityDialog.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { EntityRefLink } from '../EntityRefLink';\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Divider from '@material-ui/core/Divider';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Alert from '@material-ui/lab/Alert';\nimport { useCallback, useState } from 'react';\nimport { useUnregisterEntityDialogState } from './useUnregisterEntityDialogState';\n\nimport { alertApiRef, configApiRef, useApi } from '@backstage/core-plugin-api';\nimport { Progress, ResponseErrorPanel } from '@backstage/core-components';\nimport { assertError } from '@backstage/errors';\nimport { catalogReactTranslationRef } from '../../translation';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\n\nconst useStyles = makeStyles({\n  advancedButton: {\n    fontSize: '0.7em',\n  },\n  dialogActions: {\n    display: 'inline-block',\n  },\n});\n\nconst Contents = ({\n  entity,\n  onConfirm,\n  onClose,\n}: {\n  entity: Entity;\n  onConfirm: () => any;\n  onClose: () => any;\n}) => {\n  const alertApi = useApi(alertApiRef);\n  const configApi = useApi(configApiRef);\n  const classes = useStyles();\n  const state = useUnregisterEntityDialogState(entity);\n  const [showDelete, setShowDelete] = useState(false);\n  const [busy, setBusy] = useState(false);\n  const appTitle = configApi.getOptionalString('app.title') ?? 'Backstage';\n  const { t } = useTranslationRef(catalogReactTranslationRef);\n\n  const onUnregister = useCallback(\n    async function onUnregisterFn() {\n      if ('unregisterLocation' in state) {\n        setBusy(true);\n        try {\n          await state.unregisterLocation();\n          onConfirm();\n        } catch (err) {\n          assertError(err);\n          alertApi.post({ message: err.message });\n        } finally {\n          setBusy(false);\n        }\n      }\n    },\n    [alertApi, onConfirm, state],\n  );\n\n  const onDelete = useCallback(\n    async function onDeleteFn() {\n      if ('deleteEntity' in state) {\n        setBusy(true);\n        try {\n          await state.deleteEntity();\n          const entityName = entity.metadata.title ?? entity.metadata.name;\n          onConfirm();\n          alertApi.post({\n            message: t('unregisterEntityDialog.deleteEntitySuccessMessage', {\n              entityName,\n            }),\n            severity: 'success',\n            display: 'transient',\n          });\n        } catch (err) {\n          assertError(err);\n          alertApi.post({ message: err.message });\n        } finally {\n          setBusy(false);\n        }\n      }\n    },\n    [alertApi, onConfirm, state, entity, t],\n  );\n\n  const DialogActionsPanel = () => (\n    <DialogActions className={classes.dialogActions}>\n      <Button onClick={onClose} color=\"primary\">\n        {t('unregisterEntityDialog.cancelButtonTitle')}\n      </Button>\n    </DialogActions>\n  );\n\n  if (state.type === 'loading') {\n    return <Progress />;\n  }\n\n  if (state.type === 'error') {\n    return <ResponseErrorPanel error={state.error} />;\n  }\n\n  if (state.type === 'bootstrap') {\n    return (\n      <>\n        <Alert severity=\"info\">\n          {t('unregisterEntityDialog.bootstrapState.title', {\n            appTitle,\n            location: state.location,\n          })}\n        </Alert>\n\n        <Box marginTop={2}>\n          {!showDelete && (\n            <>\n              <Button\n                variant=\"text\"\n                size=\"small\"\n                color=\"primary\"\n                className={classes.advancedButton}\n                onClick={() => setShowDelete(true)}\n              >\n                {t('unregisterEntityDialog.bootstrapState.advancedOptions')}\n              </Button>\n              <DialogActionsPanel />\n            </>\n          )}\n\n          {showDelete && (\n            <>\n              <DialogContentText>\n                {t('unregisterEntityDialog.bootstrapState.advancedDescription')}\n              </DialogContentText>\n              <Button\n                variant=\"contained\"\n                color=\"secondary\"\n                disabled={busy}\n                onClick={onDelete}\n              >\n                {t('unregisterEntityDialog.deleteButtonTitle')}\n              </Button>\n              <DialogActionsPanel />\n            </>\n          )}\n        </Box>\n      </>\n    );\n  }\n\n  if (state.type === 'only-delete') {\n    return (\n      <>\n        <DialogContentText>\n          {t('unregisterEntityDialog.onlyDeleteStateTitle')}\n        </DialogContentText>\n        <Button\n          variant=\"contained\"\n          color=\"secondary\"\n          disabled={busy}\n          onClick={onDelete}\n        >\n          {t('unregisterEntityDialog.deleteButtonTitle')}\n        </Button>\n        <DialogActionsPanel />\n      </>\n    );\n  }\n\n  if (state.type === 'unregister') {\n    return (\n      <>\n        <DialogContentText>\n          {t('unregisterEntityDialog.unregisterState.title')}\n        </DialogContentText>\n        <DialogContentText component=\"ul\">\n          {state.colocatedEntities.map(e => (\n            <li key={`${e.kind}:${e.namespace}/${e.name}`}>\n              <EntityRefLink entityRef={e} />\n            </li>\n          ))}\n        </DialogContentText>\n        <DialogContentText>\n          {t('unregisterEntityDialog.unregisterState.subTitle')}\n        </DialogContentText>\n        <DialogContentText component=\"ul\">\n          <li>{state.location}</li>\n        </DialogContentText>\n        <DialogContentText>\n          {t('unregisterEntityDialog.unregisterState.description', {\n            appTitle,\n          })}\n        </DialogContentText>\n        <Box marginTop={2}>\n          <Button\n            variant=\"contained\"\n            color=\"secondary\"\n            disabled={busy}\n            onClick={onUnregister}\n          >\n            {t('unregisterEntityDialog.unregisterState.unregisterButtonTitle')}\n          </Button>\n          {!showDelete && (\n            <Box component=\"span\" marginLeft={2}>\n              <Button\n                variant=\"text\"\n                size=\"small\"\n                color=\"primary\"\n                className={classes.advancedButton}\n                onClick={() => setShowDelete(true)}\n              >\n                {t('unregisterEntityDialog.unregisterState.advancedOptions')}\n              </Button>\n            </Box>\n          )}\n        </Box>\n\n        {showDelete && (\n          <>\n            <Box paddingTop={4} paddingBottom={4}>\n              <Divider />\n            </Box>\n            <DialogContentText>\n              {t('unregisterEntityDialog.unregisterState.advancedDescription')}\n            </DialogContentText>\n            <Button\n              variant=\"contained\"\n              color=\"secondary\"\n              disabled={busy}\n              onClick={onDelete}\n            >\n              {t('unregisterEntityDialog.deleteButtonTitle')}\n            </Button>\n          </>\n        )}\n      </>\n    );\n  }\n\n  return (\n    <Alert severity=\"error\">\n      {t('unregisterEntityDialog.errorStateTitle')}\n    </Alert>\n  );\n};\n\n/** @public */\nexport type UnregisterEntityDialogProps = {\n  open: boolean;\n  onConfirm: () => any;\n  onClose: () => any;\n  entity: Entity;\n};\n\n/** @public */\nexport const UnregisterEntityDialog = (props: UnregisterEntityDialogProps) => {\n  const { open, onConfirm, onClose, entity } = props;\n  const { t } = useTranslationRef(catalogReactTranslationRef);\n  return (\n    <Dialog open={open} onClose={onClose}>\n      <DialogTitle id=\"responsive-dialog-title\">\n        {t('unregisterEntityDialog.title')}\n      </DialogTitle>\n      <DialogContent>\n        <Contents entity={entity} onConfirm={onConfirm} onClose={onClose} />\n      </DialogContent>\n    </Dialog>\n  );\n};\n"],"names":[],"mappings":"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"}