{"version":3,"file":"EntityPeekAheadPopover.esm.js","sources":["../../../src/components/EntityPeekAheadPopover/EntityPeekAheadPopover.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport useAsyncFn from 'react-use/esm/useAsyncFn';\nimport { catalogApiRef } from '../../api';\nimport { PropsWithChildren, useEffect, useMemo, useState } from 'react';\nimport HoverPopover from 'material-ui-popup-state/HoverPopover';\nimport {\n  bindHover,\n  bindPopover,\n  usePopupState,\n} from 'material-ui-popup-state/hooks';\nimport Box from '@material-ui/core/Box';\nimport Card from '@material-ui/core/Card';\nimport CardActions from '@material-ui/core/CardActions';\nimport CardContent from '@material-ui/core/CardContent';\nimport Chip from '@material-ui/core/Chip';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useApiHolder } from '@backstage/core-plugin-api';\nimport { isGroupEntity, isUserEntity } from '@backstage/catalog-model';\nimport { Progress, ResponseErrorPanel } from '@backstage/core-components';\nimport {\n  EntityCardActions,\n  UserCardActions,\n  GroupCardActions,\n} from './CardActionComponents';\nimport { debounce } from 'lodash';\nimport { catalogReactTranslationRef } from '../../translation';\nimport { useTranslationRef } from '@backstage/core-plugin-api/alpha';\n\n/**\n * Properties for an entity popover on hover of a component.\n *\n * @public\n */\nexport type EntityPeekAheadPopoverProps = PropsWithChildren<{\n  entityRef: string;\n  delayTime?: number;\n}>;\n\nconst useStyles = makeStyles(() => {\n  return {\n    popoverPaper: {\n      width: '30em',\n    },\n    descriptionTypography: {\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n      display: '-webkit-box',\n      WebkitLineClamp: 2,\n      WebkitBoxOrient: 'vertical',\n    },\n  };\n});\n\nconst maxTagChips = 4;\n\n/**\n * Shows an entity popover on hover of a component.\n *\n * @public\n */\nexport const EntityPeekAheadPopover = (props: EntityPeekAheadPopoverProps) => {\n  const { entityRef, children, delayTime = 500 } = props;\n  const { t } = useTranslationRef(catalogReactTranslationRef);\n  const classes = useStyles();\n  const apiHolder = useApiHolder();\n  const popupState = usePopupState({\n    variant: 'popover',\n    popupId: 'entity-peek-ahead',\n  });\n  const [isHovered, setIsHovered] = useState(false);\n\n  const debouncedHandleMouseEnter = useMemo(\n    () => debounce(() => setIsHovered(true), delayTime),\n    [delayTime],\n  );\n\n  const [{ loading, error, value: entity }, load] = useAsyncFn(async () => {\n    const catalogApi = apiHolder.get(catalogApiRef);\n    if (catalogApi) {\n      const retrievedEntity = await catalogApi.getEntityByRef(entityRef);\n      if (!retrievedEntity) {\n        throw new Error(`${entityRef} not found`);\n      }\n      return retrievedEntity;\n    }\n    return undefined;\n  }, [apiHolder, entityRef]);\n\n  const handleOnMouseLeave = () => {\n    setIsHovered(false);\n    debouncedHandleMouseEnter.cancel();\n  };\n\n  useEffect(() => {\n    if (popupState.isOpen && !entity && !error && !loading) {\n      load();\n    }\n  }, [popupState.isOpen, load, entity, error, loading]);\n\n  return (\n    <>\n      <Typography component=\"span\" onMouseEnter={debouncedHandleMouseEnter}>\n        <Typography\n          component=\"span\"\n          data-testid=\"trigger\"\n          {...bindHover(popupState)}\n        >\n          {children}\n        </Typography>\n      </Typography>\n      {isHovered && (\n        <HoverPopover\n          PaperProps={{\n            className: classes.popoverPaper,\n          }}\n          {...bindPopover(popupState)}\n          anchorOrigin={{\n            vertical: 'bottom',\n            horizontal: 'center',\n          }}\n          transformOrigin={{\n            vertical: 'top',\n            horizontal: 'center',\n          }}\n          onMouseLeave={handleOnMouseLeave}\n        >\n          <Card>\n            <CardContent>\n              {error && <ResponseErrorPanel error={error} />}\n              {loading && <Progress />}\n              {entity && (\n                <>\n                  <Typography color=\"textSecondary\">\n                    {entity.metadata.namespace}\n                  </Typography>\n                  <Typography variant=\"h5\" component=\"div\">\n                    {entity.metadata.name}\n                  </Typography>\n                  <Typography color=\"textSecondary\" gutterBottom>\n                    {entity.kind}\n                  </Typography>\n                  {entity.metadata.description && (\n                    <Typography\n                      className={classes.descriptionTypography}\n                      paragraph\n                    >\n                      {entity.metadata.description}\n                    </Typography>\n                  )}\n                  <Typography>{entity.spec?.type?.toString()}</Typography>\n                  <Box marginTop=\"0.5em\">\n                    {(entity.metadata.tags || [])\n                      .slice(0, maxTagChips)\n                      .map(tag => {\n                        return <Chip key={tag} size=\"small\" label={tag} />;\n                      })}\n                    {entity.metadata.tags?.length &&\n                      entity.metadata.tags?.length > maxTagChips && (\n                        <Tooltip title={t('entityPeekAheadPopover.title')}>\n                          <Chip key=\"other-tags\" size=\"small\" label=\"...\" />\n                        </Tooltip>\n                      )}\n                  </Box>\n                </>\n              )}\n            </CardContent>\n            {!error && entity && (\n              <CardActions>\n                <>\n                  {isUserEntity(entity) && <UserCardActions entity={entity} />}\n                  {isGroupEntity(entity) && (\n                    <GroupCardActions entity={entity} />\n                  )}\n                  <EntityCardActions entity={entity} />\n                </>\n              </CardActions>\n            )}\n          </Card>\n        </HoverPopover>\n      )}\n    </>\n  );\n};\n"],"names":[],"mappings":"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"}