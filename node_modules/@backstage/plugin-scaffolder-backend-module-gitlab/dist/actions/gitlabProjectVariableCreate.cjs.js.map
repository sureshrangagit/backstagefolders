{"version":3,"file":"gitlabProjectVariableCreate.cjs.js","sources":["../../src/actions/gitlabProjectVariableCreate.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ScmIntegrationRegistry } from '@backstage/integration';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { VariableType } from '@gitbeaker/rest';\nimport { getClient, parseRepoUrl } from '../util';\nimport { examples } from './gitlabProjectVariableCreate.examples';\n\n/**\n * Creates a `gitlab:projectVariable:create` Scaffolder action.\n *\n * @param options - Templating configuration.\n * @public\n */\nexport const createGitlabProjectVariableAction = (options: {\n  integrations: ScmIntegrationRegistry;\n}) => {\n  const { integrations } = options;\n  return createTemplateAction({\n    id: 'gitlab:projectVariable:create',\n    examples,\n    schema: {\n      input: {\n        repoUrl: z =>\n          z.string({\n            description: `Accepts the format 'gitlab.com?repo=project_name&owner=group_name' where 'project_name' is the repository name and 'group_name' is a group or username`,\n          }),\n        token: z =>\n          z\n            .string({\n              description: 'The token to use for authorization to GitLab',\n            })\n            .optional(),\n        projectId: z =>\n          z.union([z.number(), z.string()], {\n            description: 'Project ID',\n          }),\n        key: z =>\n          z\n            .string({\n              description:\n                'The key of a variable; must have no more than 255 characters; only A-Z, a-z, 0-9, and _ are allowed',\n            })\n            .regex(/^[A-Za-z0-9_]{1,255}$/),\n        value: z =>\n          z.string({\n            description: 'The value of a variable',\n          }),\n        variableType: z =>\n          z.string({\n            description: 'Variable Type (env_var or file)',\n          }),\n        variableProtected: z =>\n          z\n            .boolean({\n              description: 'Whether the variable is protected',\n            })\n            .default(false)\n            .optional(),\n        masked: z =>\n          z\n            .boolean({\n              description: 'Whether the variable is masked',\n            })\n            .default(false)\n            .optional(),\n        raw: z =>\n          z\n            .boolean({\n              description: 'Whether the variable is expandable',\n            })\n            .default(false)\n            .optional(),\n        environmentScope: z =>\n          z\n            .string({\n              description: 'The environment_scope of the variable',\n            })\n            .default('*')\n            .optional(),\n      },\n    },\n    async handler(ctx) {\n      const {\n        repoUrl,\n        projectId,\n        key,\n        value,\n        variableType,\n        variableProtected = false,\n        masked = false,\n        raw = false,\n        environmentScope = '*',\n        token,\n      } = ctx.input;\n\n      const { host } = parseRepoUrl(repoUrl, integrations);\n\n      const api = getClient({ host, integrations, token });\n\n      await ctx.checkpoint({\n        key: `create.project.variables.${projectId}.${key}.${value}`,\n        fn: async () => {\n          await api.ProjectVariables.create(projectId, key, value, {\n            variableType: variableType as VariableType,\n            protected: variableProtected,\n            masked,\n            raw,\n            environmentScope,\n          });\n        },\n      });\n    },\n  });\n};\n"],"names":["createTemplateAction","examples","parseRepoUrl","getClient"],"mappings":"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"}